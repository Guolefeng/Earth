define(["exports","./GeometryOffsetAttribute-1772960d","./Transforms-d5c6ad6e","./Matrix2-ccd5b911","./ComponentDatatype-93750d1a","./when-4bbc8319","./RuntimeError-346a3079","./GeometryAttribute-c30799b8","./GeometryAttributes-7827a6c2","./IndexDatatype-b7d979a6","./VertexFormat-71718faa"],(function(t,e,a,i,r,n,o,m,s,u,l){"use strict";var c=new i.Cartesian3,f=new i.Cartesian3,d=new i.Cartesian3,C=new i.Cartesian3,p=new i.Cartesian3,y=new i.Cartesian3(1,1,1),_=Math.cos,h=Math.sin;function v(t){t=n.defaultValue(t,n.defaultValue.EMPTY_OBJECT);var e=n.defaultValue(t.radii,y),a=n.defaultValue(t.innerRadii,e),o=n.defaultValue(t.minimumClock,0),m=n.defaultValue(t.maximumClock,r.CesiumMath.TWO_PI),s=n.defaultValue(t.minimumCone,0),u=n.defaultValue(t.maximumCone,r.CesiumMath.PI),c=Math.round(n.defaultValue(t.stackPartitions,64)),f=Math.round(n.defaultValue(t.slicePartitions,64)),d=n.defaultValue(t.vertexFormat,l.VertexFormat.DEFAULT);this._radii=i.Cartesian3.clone(e),this._innerRadii=i.Cartesian3.clone(a),this._minimumClock=o,this._maximumClock=m,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=c,this._slicePartitions=f,this._vertexFormat=l.VertexFormat.clone(d),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}v.packedLength=2*i.Cartesian3.packedLength+l.VertexFormat.packedLength+7,v.pack=function(t,e,a){return a=n.defaultValue(a,0),i.Cartesian3.pack(t._radii,e,a),a+=i.Cartesian3.packedLength,i.Cartesian3.pack(t._innerRadii,e,a),a+=i.Cartesian3.packedLength,l.VertexFormat.pack(t._vertexFormat,e,a),a+=l.VertexFormat.packedLength,e[a++]=t._minimumClock,e[a++]=t._maximumClock,e[a++]=t._minimumCone,e[a++]=t._maximumCone,e[a++]=t._stackPartitions,e[a++]=t._slicePartitions,e[a]=n.defaultValue(t._offsetAttribute,-1),e};var x,A=new i.Cartesian3,b=new i.Cartesian3,k=new l.VertexFormat,w={radii:A,innerRadii:b,vertexFormat:k,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};v.unpack=function(t,e,a){e=n.defaultValue(e,0);var r=i.Cartesian3.unpack(t,e,A);e+=i.Cartesian3.packedLength;var o=i.Cartesian3.unpack(t,e,b);e+=i.Cartesian3.packedLength;var m=l.VertexFormat.unpack(t,e,k);e+=l.VertexFormat.packedLength;var s=t[e++],u=t[e++],c=t[e++],f=t[e++],d=t[e++],C=t[e++];e=t[e];return n.defined(a)?(a._radii=i.Cartesian3.clone(r,a._radii),a._innerRadii=i.Cartesian3.clone(o,a._innerRadii),a._vertexFormat=l.VertexFormat.clone(m,a._vertexFormat),a._minimumClock=s,a._maximumClock=u,a._minimumCone=c,a._maximumCone=f,a._stackPartitions=d,a._slicePartitions=C,a._offsetAttribute=-1===e?void 0:e,a):(w.minimumClock=s,w.maximumClock=u,w.minimumCone=c,w.maximumCone=f,w.stackPartitions=d,w.slicePartitions=C,w.offsetAttribute=-1===e?void 0:e,new v(w))},v.createGeometry=function(t){var o=t._radii;if(!(o.x<=0||o.y<=0||o.z<=0)){var l=t._innerRadii;if(!(l.x<=0||l.y<=0||l.z<=0)){var y=t._minimumClock,v=t._maximumClock,x=t._minimumCone,A=t._maximumCone,b=t._vertexFormat,k=t._slicePartitions+1,w=t._stackPartitions+1;(k=Math.round(k*Math.abs(v-y)/r.CesiumMath.TWO_PI))<2&&(k=2),(w=Math.round(w*Math.abs(A-x)/r.CesiumMath.PI))<2&&(w=2);var F=0,P=[x],g=[y];for(it=0;it<w;it++)P.push(x+it*(A-x)/(w-1));for(P.push(A),H=0;H<k;H++)g.push(y+H*(v-y)/(k-1));g.push(v);var V=P.length,M=g.length,T=0,D=1,G=l.x!==o.x||l.y!==o.y||l.z!==o.z,L=!1,O=!1,I=!1;G&&(D=2,0<x&&(L=!0,T+=k-1),A<Math.PI&&(O=!0,T+=k-1),(v-y)%r.CesiumMath.TWO_PI?(I=!0,T+=2*(w-1)+1):T+=1);var E=M*V*D,z=new Float64Array(3*E),N=e.arrayFill(new Array(E),!1),R=e.arrayFill(new Array(E),!1),U=k*w*D,S=u.IndexDatatype.createTypedArray(U,6*(U+T+1-(k+w)*D)),B=b.normal?new Float32Array(3*E):void 0,W=b.tangent?new Float32Array(3*E):void 0,Y=b.bitangent?new Float32Array(3*E):void 0,J=b.st?new Float32Array(2*E):void 0,X=new Array(V),Z=new Array(V);for(it=0;it<V;it++)X[it]=h(P[it]),Z[it]=_(P[it]);for(var j=new Array(M),q=new Array(M),H=0;H<M;H++)q[H]=_(g[H]),j[H]=h(g[H]);for(it=0;it<V;it++)for(H=0;H<M;H++)z[F++]=o.x*X[it]*q[H],z[F++]=o.y*X[it]*j[H],z[F++]=o.z*Z[it];var K,Q,$,tt,et=E/2;if(G)for(it=0;it<V;it++)for(H=0;H<M;H++)z[F++]=l.x*X[it]*q[H],z[F++]=l.y*X[it]*j[H],z[F++]=l.z*Z[it],N[et]=!0,0<it&&it!==V-1&&0!==H&&H!==M-1&&(R[et]=!0),et++;for(F=0,it=1;it<V-2;it++)for(K=it*M,Q=(it+1)*M,H=1;H<M-2;H++)S[F++]=Q+H,S[F++]=Q+H+1,S[F++]=K+H+1,S[F++]=Q+H,S[F++]=K+H+1,S[F++]=K+H;if(G)for(var at=V*M,it=1;it<V-2;it++)for(K=at+it*M,Q=at+(it+1)*M,H=1;H<M-2;H++)S[F++]=Q+H,S[F++]=K+H,S[F++]=K+H+1,S[F++]=Q+H,S[F++]=K+H+1,S[F++]=Q+H+1;if(G){if(L)for(tt=V*M,it=1;it<M-2;it++)S[F++]=it,S[F++]=it+1,S[F++]=tt+it+1,S[F++]=it,S[F++]=tt+it+1,S[F++]=tt+it;if(O)for($=V*M-M,tt=V*M*D-M,it=1;it<M-2;it++)S[F++]=$+it+1,S[F++]=$+it,S[F++]=tt+it,S[F++]=$+it+1,S[F++]=tt+it,S[F++]=tt+it+1}if(I){for(it=1;it<V-2;it++)S[F++]=tt=M*V+($=M*it),S[F++]=$+M,S[F++]=$,S[F++]=tt,S[F++]=tt+M,S[F++]=$+M;for(it=1;it<V-2;it++)tt=M*V+M*(it+1)-1,S[F++]=($=M*(it+1)-1)+M,S[F++]=tt,S[F++]=$,S[F++]=$+M,S[F++]=tt+M,S[F++]=tt}O=new s.GeometryAttributes,b.position&&(O.position=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:z}));var rt=0,nt=0,ot=0,mt=0,st=E/2,ut=i.Ellipsoid.fromCartesian3(o),lt=i.Ellipsoid.fromCartesian3(l);if(b.st||b.normal||b.tangent||b.bitangent){for(it=0;it<E;it++){var ct,ft=N[it]?lt:ut,dt=i.Cartesian3.fromArray(z,3*it,c);dt=ft.geodeticSurfaceNormal(dt,f);R[it]&&i.Cartesian3.negate(dt,dt),b.st&&(ct=i.Cartesian2.negate(dt,p),J[rt++]=Math.atan2(ct.y,ct.x)/r.CesiumMath.TWO_PI+.5,J[rt++]=Math.asin(dt.z)/Math.PI+.5),b.normal&&(B[nt++]=dt.x,B[nt++]=dt.y,B[nt++]=dt.z),(b.tangent||b.bitangent)&&(ct=0,N[it]&&(ct=st),ct=!L&&ct<=it&&it<ct+2*M?i.Cartesian3.UNIT_X:i.Cartesian3.UNIT_Z,i.Cartesian3.cross(ct,dt,ct=d),i.Cartesian3.normalize(ct,ct),b.tangent&&(W[ot++]=ct.x,W[ot++]=ct.y,W[ot++]=ct.z),b.bitangent&&(ct=i.Cartesian3.cross(dt,ct,C),i.Cartesian3.normalize(ct,ct),Y[mt++]=ct.x,Y[mt++]=ct.y,Y[mt++]=ct.z))}b.st&&(O.st=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:J})),b.normal&&(O.normal=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:B})),b.tangent&&(O.tangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:W})),b.bitangent&&(O.bitangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Y}))}return n.defined(t._offsetAttribute)&&(D=z.length,I=new Uint8Array(D/3),D=t._offsetAttribute===e.GeometryOffsetAttribute.NONE?0:1,e.arrayFill(I,D),O.applyOffset=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:I})),new m.Geometry({attributes:O,indices:S,primitiveType:m.PrimitiveType.TRIANGLES,boundingSphere:a.BoundingSphere.fromEllipsoid(ut),offsetAttribute:t._offsetAttribute})}}},v.getUnitEllipsoid=function(){return x=n.defined(x)?x:v.createGeometry(new v({radii:new i.Cartesian3(1,1,1),vertexFormat:l.VertexFormat.POSITION_ONLY}))},t.EllipsoidGeometry=v}));