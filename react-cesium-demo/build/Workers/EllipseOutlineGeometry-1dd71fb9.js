define(["exports","./GeometryOffsetAttribute-1772960d","./Transforms-d5c6ad6e","./Matrix2-ccd5b911","./ComponentDatatype-93750d1a","./when-4bbc8319","./RuntimeError-346a3079","./EllipseGeometryLibrary-9dda9a85","./GeometryAttribute-c30799b8","./GeometryAttributes-7827a6c2","./IndexDatatype-b7d979a6"],(function(e,t,i,r,a,n,o,s,u,l,d){"use strict";var p=new r.Cartesian3,c=new r.Cartesian3,m=new i.BoundingSphere,f=new i.BoundingSphere;function h(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).center,i=n.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84),o=e.semiMajorAxis,s=e.semiMinorAxis,u=n.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),l=n.defaultValue(e.height,0),d=n.defaultValue(e.extrudedHeight,l);this._center=r.Cartesian3.clone(t),this._semiMajorAxis=o,this._semiMinorAxis=s,this._ellipsoid=r.Ellipsoid.clone(i),this._rotation=n.defaultValue(e.rotation,0),this._height=Math.max(d,l),this._granularity=u,this._extrudedHeight=Math.min(d,l),this._numberOfVerticalLines=Math.max(n.defaultValue(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}h.packedLength=r.Cartesian3.packedLength+r.Ellipsoid.packedLength+8,h.pack=function(e,t,i){return i=n.defaultValue(i,0),r.Cartesian3.pack(e._center,t,i),i+=r.Cartesian3.packedLength,r.Ellipsoid.pack(e._ellipsoid,t,i),i+=r.Ellipsoid.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._numberOfVerticalLines,t[i]=n.defaultValue(e._offsetAttribute,-1),t};var y=new r.Cartesian3,b=new r.Ellipsoid,A={center:y,ellipsoid:b,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};h.unpack=function(e,t,i){t=n.defaultValue(t,0);var a=r.Cartesian3.unpack(e,t,y);t+=r.Cartesian3.packedLength;var o=r.Ellipsoid.unpack(e,t,b);t+=r.Ellipsoid.packedLength;var s=e[t++],u=e[t++],l=e[t++],d=e[t++],p=e[t++],c=e[t++],m=e[t++];t=e[t];return n.defined(i)?(i._center=r.Cartesian3.clone(a,i._center),i._ellipsoid=r.Ellipsoid.clone(o,i._ellipsoid),i._semiMajorAxis=s,i._semiMinorAxis=u,i._rotation=l,i._height=d,i._granularity=p,i._extrudedHeight=c,i._numberOfVerticalLines=m,i._offsetAttribute=-1===t?void 0:t,i):(A.height=d,A.extrudedHeight=c,A.granularity=p,A.rotation=l,A.semiMajorAxis=s,A.semiMinorAxis=u,A.numberOfVerticalLines=m,A.offsetAttribute=-1===t?void 0:t,new h(A))},h.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var o=e._height,h=e._extrudedHeight,y=!a.CesiumMath.equalsEpsilon(o,h,0,a.CesiumMath.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var b;o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:o,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};return y?(o.extrudedHeight=h,o.offsetAttribute=e._offsetAttribute,b=function(e){var o=e.center,c=e.ellipsoid,h=e.semiMajorAxis,y=r.Cartesian3.multiplyByScalar(c.geodeticSurfaceNormal(o,p),e.height,p);m.center=r.Cartesian3.add(o,y,m.center),m.radius=h,y=r.Cartesian3.multiplyByScalar(c.geodeticSurfaceNormal(o,y),e.extrudedHeight,y),f.center=r.Cartesian3.add(o,y,f.center),f.radius=h;o=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,o=(y=new l.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(o,e,!0)})})).position.values,h=i.BoundingSphere.union(m,f);var b=o.length/3;n.defined(e.offsetAttribute)&&(A=new Uint8Array(b),A=e.offsetAttribute===t.GeometryOffsetAttribute.TOP?t.arrayFill(A,1,0,b/2):(o=e.offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1,t.arrayFill(A,o)),y.applyOffset=new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:A}));var A=n.defaultValue(e.numberOfVerticalLines,16),_=(A=a.CesiumMath.clamp(A,0,b/2),d.IndexDatatype.createTypedArray(b,2*b+2*A));b/=2;var g=0;for(v=0;v<b;++v)_[g++]=v,_[g++]=(v+1)%b,_[g++]=v+b,_[g++]=(v+1)%b+b;if(0<A){e=Math.min(A,b);for(var x=Math.round(b/e),E=Math.min(x*A,b),v=0;v<E;v+=x)_[g++]=v,_[g++]=v+b}return{boundingSphere:h,attributes:y,indices:_}}(o)):(b=function(e){var t=e.center;c=r.Cartesian3.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,c),e.height,c),c=r.Cartesian3.add(t,c,c);for(var n=new i.BoundingSphere(c,e.semiMajorAxis),o=(t=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,e=new l.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(t,e,!1)})}),t.length/3),p=d.IndexDatatype.createTypedArray(o,2*o),m=0,f=0;f<o;++f)p[m++]=f,p[m++]=(f+1)%o;return{boundingSphere:n,attributes:e,indices:p}}(o),n.defined(e._offsetAttribute)&&(h=b.attributes.position.values.length,o=new Uint8Array(h/3),h=e._offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1,t.arrayFill(o,h),b.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:o}))),new u.Geometry({attributes:b.attributes,indices:b.indices,primitiveType:u.PrimitiveType.LINES,boundingSphere:b.boundingSphere,offsetAttribute:e._offsetAttribute})}},e.EllipseOutlineGeometry=h}));