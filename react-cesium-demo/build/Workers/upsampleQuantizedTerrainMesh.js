define(["./AttributeCompression-1f045b73","./Transforms-d5c6ad6e","./Matrix2-ccd5b911","./when-4bbc8319","./TerrainEncoding-bccee540","./IndexDatatype-b7d979a6","./RuntimeError-346a3079","./ComponentDatatype-93750d1a","./OrientedBoundingBox-0a826a8b","./createTaskProcessorWorker","./combine-83860057","./WebGLConstants-1c8239cc","./EllipsoidTangentPlane-e000bae1","./AxisAlignedBoundingBox-883f9c89","./IntersectionTests-4d6f5c54","./Plane-18bb00f8"],(function(e,t,i,n,s,r,h,u,o,p,a,d,f,l,c,g){"use strict";var m=function(e,t,i,s,r,h){var u,o;n.defined(h)?h.length=0:h=[];var p,a,d,f,l,c,g=t?(u=i<e,o=s<e,r<e):(u=e<i,o=e<s,e<r);return 1===(t=u+o+g)?u?(p=(e-i)/(s-i),a=(e-i)/(r-i),h.push(1),h.push(2),1!==a&&(h.push(-1),h.push(0),h.push(2),h.push(a)),1!==p&&(h.push(-1),h.push(0),h.push(1),h.push(p))):o?(d=(e-s)/(r-s),f=(e-s)/(i-s),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==d&&(h.push(-1),h.push(1),h.push(2),h.push(d))):g&&(l=(e-r)/(i-r),c=(e-r)/(s-r),h.push(0),h.push(1),1!==c&&(h.push(-1),h.push(2),h.push(1),h.push(c)),1!==l&&(h.push(-1),h.push(2),h.push(0),h.push(l))):2===t?u||i===e?o||s===e?g||r===e||(a=(e-i)/(r-i),d=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(a),h.push(-1),h.push(1),h.push(2),h.push(d)):(c=(e-r)/(s-r),p=(e-i)/(s-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(c),h.push(-1),h.push(0),h.push(1),h.push(p)):(f=(e-s)/(i-s),l=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(l)):3!==t&&(h.push(0),h.push(1),h.push(2)),h},x=32767,w=16383,v=[],C=[],B=[],y=new i.Cartographic,b=new i.Cartesian3,I=[],A=[],z=[],M=[],N=[],V=new i.Cartesian3,E=new t.BoundingSphere,R=new o.OrientedBoundingBox,H=new i.Cartesian2,T=new i.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return(e=n.defined(e)?e:new O).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],this.second=i[e[++n]],this.ratio=e[++n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return n.defined(this.index)},O.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var U=new i.Cartesian2,F=-1,P=[new i.Cartesian3,new i.Cartesian3],S=[new i.Cartesian3,new i.Cartesian3];function D(t,n){var s=P[++F],r=S[F];s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r);return b=i.Cartesian3.lerp(s,r,t.ratio,b),i.Cartesian3.normalize(b,b),e.AttributeCompression.octEncode(b,n),--F,n}O.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(U=D(this,U)).x},O.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=D(this,U)).y};var W=[];function X(e,t,i,s,r,h,u,o,p){if(0!==u.length){for(var a=0,d=0;d<u.length;)d=W[a++].initializeFromClipResult(u,d,o);for(var f=0;f<a;++f){var l,c,g=W[f];g.isIndexed()?(g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,p&&(g.normalBuffer=s)):(l=g.getKey(),n.defined(h[l])?g.newIndex=h[l]:(c=e.length,e.push(g.getU()),t.push(g.getV()),i.push(g.getH()),p&&(s.push(g.getNormalX()),s.push(g.getNormalY())),g.newIndex=c,h[l]=c))}3===a?(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex)):4===a&&(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex),r.push(W[0].newIndex),r.push(W[2].newIndex),r.push(W[3].newIndex))}}return W.push(new O),W.push(new O),W.push(new O),W.push(new O),p((function(e,n){var h=e.isEastChild,p=e.isNorthChild,a=h?w:0,d=h?x:w,f=p?w:0,l=p?x:w,c=I,g=A,U=z,F=N;c.length=0,g.length=0,U.length=0,F.length=0;var P=M;P.length=0;for(var S={},D=e.vertices,W=(W=e.indices).subarray(0,e.indexCountWithoutSkirts),k=s.TerrainEncoding.clone(e.encoding),K=k.hasVertexNormals,Y=0,L=e.vertexCountWithoutSkirts,_=e.minimumHeight,G=e.maximumHeight,J=new Array(L),Z=new Array(L),j=new Array(L),q=K?new Array(2*L):void 0,Q=0,$=0;Q<L;++Q,$+=2){var ee=k.decodeTextureCoordinates(D,Q,H),te=k.decodeHeight(D,Q),ie=u.CesiumMath.clamp(ee.x*x|0,0,x),ne=u.CesiumMath.clamp(ee.y*x|0,0,x);j[Q]=u.CesiumMath.clamp((te-_)/(G-_)*x|0,0,x),x-(ie=ie<20?0:ie)<20&&(ie=x),x-(ne=ne<20?0:ne)<20&&(ne=x),J[Q]=ie,Z[Q]=ne,K&&(ee=k.getOctEncodedNormal(D,Q,T),q[$]=ee.x,q[$+1]=ee.y),(h&&w<=ie||!h&&ie<=w)&&(p&&w<=ne||!p&&ne<=w)&&(S[Q]=Y,c.push(ie),g.push(ne),U.push(j[Q]),K&&(F.push(q[$]),F.push(q[$+1])),++Y)}var se=[];se.push(new O),se.push(new O),se.push(new O);var re=[];for(re.push(new O),re.push(new O),re.push(new O),Q=0;Q<W.length;Q+=3){var he=W[Q],ue=W[Q+1],oe=W[Q+2],pe=J[he],ae=J[ue],de=J[oe];se[0].initializeIndexed(J,Z,j,q,he),se[1].initializeIndexed(J,Z,j,q,ue),se[2].initializeIndexed(J,Z,j,q,oe),(ae=m(w,h,pe,ae,de,v)).length<=0||(de=re[0].initializeFromClipResult(ae,0,se))>=ae.length||(de=re[1].initializeFromClipResult(ae,de,se))>=ae.length||(de=re[2].initializeFromClipResult(ae,de,se),X(c,g,U,F,P,S,m(w,p,re[0].getV(),re[1].getV(),re[2].getV(),C),re,K),de<ae.length&&(re[2].clone(re[1]),re[2].initializeFromClipResult(ae,de,se),X(c,g,U,F,P,S,m(w,p,re[0].getV(),re[1].getV(),re[2].getV(),C),re,K)))}var fe=h?-x:0,le=p?-x:0,ce=[],ge=[],me=[],xe=[],we=Number.MAX_VALUE,ve=-we,Ce=B;Ce.length=0;var Be=i.Ellipsoid.clone(e.ellipsoid),ye=(He=i.Rectangle.clone(e.childRectangle)).north,be=He.south,Ie=He.east,Ae=He.west;for(Ie<Ae&&(Ie+=u.CesiumMath.TWO_PI),Q=0;Q<c.length;++Q)ie=(ie=Math.round(c[Q]))<=a?(ce.push(Q),0):d<=ie?(me.push(Q),x):2*ie+fe,c[Q]=ie,ne=(ne=Math.round(g[Q]))<=f?(ge.push(Q),0):l<=ne?(xe.push(Q),x):2*ne+le,g[Q]=ne,(te=u.CesiumMath.lerp(_,G,U[Q]/x))<we&&(we=te),ve<te&&(ve=te),U[Q]=te,y.longitude=u.CesiumMath.lerp(Ae,Ie,ie/x),y.latitude=u.CesiumMath.lerp(be,ye,ne/x),y.height=te,Be.cartographicToCartesian(y,b),Ce.push(b.x),Ce.push(b.y),Ce.push(b.z);var ze=t.BoundingSphere.fromVertices(Ce,i.Cartesian3.ZERO,3,E),Me=o.OrientedBoundingBox.fromRectangle(He,we,ve,Be,R),Ne=(e=new s.EllipsoidalOccluder(Be).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ze.center,Ce,3,ze.center,we,V),ve-we),Ve=new Uint16Array(c.length+g.length+U.length);for(Q=0;Q<c.length;++Q)Ve[Q]=c[Q];var Ee=c.length;for(Q=0;Q<g.length;++Q)Ve[Ee+Q]=g[Q];for(Ee+=g.length,Q=0;Q<U.length;++Q)Ve[Ee+Q]=x*(U[Q]-we)/Ne;var Re,He=r.IndexDatatype.createTypedArray(c.length,P);return K?(Re=new Uint8Array(F),n.push(Ve.buffer,He.buffer,Re.buffer),Re=Re.buffer):n.push(Ve.buffer,He.buffer),{vertices:Ve.buffer,encodedNormals:Re,indices:He.buffer,minimumHeight:we,maximumHeight:ve,westIndices:ce,southIndices:ge,eastIndices:me,northIndices:xe,boundingSphere:ze,orientedBoundingBox:Me,horizonOcclusionPoint:e}}))}));