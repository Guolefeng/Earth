define(["./AxisAlignedBoundingBox-883f9c89","./Matrix2-ccd5b911","./when-4bbc8319","./TerrainEncoding-bccee540","./IndexDatatype-b7d979a6","./ComponentDatatype-93750d1a","./RuntimeError-346a3079","./Transforms-d5c6ad6e","./WebMercatorProjection-b29097b4","./createTaskProcessorWorker","./AttributeCompression-1f045b73","./WebGLConstants-1c8239cc","./combine-83860057"],(function(e,t,r,n,i,o,a,s,d,c,h,u,I){"use strict";function l(){a.DeveloperError.throwInstantiationError()}Object.defineProperties(l.prototype,{errorEvent:{get:a.DeveloperError.throwInstantiationError},credit:{get:a.DeveloperError.throwInstantiationError},tilingScheme:{get:a.DeveloperError.throwInstantiationError},ready:{get:a.DeveloperError.throwInstantiationError},readyPromise:{get:a.DeveloperError.throwInstantiationError},hasWaterMask:{get:a.DeveloperError.throwInstantiationError},hasVertexNormals:{get:a.DeveloperError.throwInstantiationError},availability:{get:a.DeveloperError.throwInstantiationError}});var g=[];l.getRegularGridIndices=function(e,t){var n=g[e];r.defined(n)||(g[e]=n=[]);var i=n[t];return r.defined(i)||p(e,t,i=e*t<o.CesiumMath.SIXTY_FOUR_KILOBYTES?n[t]=new Uint16Array((e-1)*(t-1)*6):n[t]=new Uint32Array((e-1)*(t-1)*6),0),i};var m=[];l.getRegularGridIndicesAndEdgeIndices=function(e,t){var n=m[e];r.defined(n)||(m[e]=n=[]);var i,o,a,s,d=n[t];return r.defined(d)||(i=l.getRegularGridIndices(e,t),o=(s=E(e,t)).westIndicesSouthToNorth,a=s.southIndicesEastToWest,e=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,d=n[t]={indices:i,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:e,northIndicesWestToEast:s}),d};var T=[];function E(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function p(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,c=d+1,h=s+1;r[n++]=s,r[n++]=d,r[n++]=h,r[n++]=h,r[n++]=d,r[n++]=c,++i}++i}}function f(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}l.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var n=T[e];r.defined(n)||(T[e]=n=[]);var o,a,s,d,c,h,u,I,g=n[t];return r.defined(g)||(s=(o=e*t)+(h=2*e+2*t),I=(a=(e-1)*(t-1)*6)+6*Math.max(0,h-4),d=(u=E(e,t)).westIndicesSouthToNorth,c=u.southIndicesEastToWest,h=u.eastIndicesNorthToSouth,u=u.northIndicesWestToEast,p(e,t,I=i.IndexDatatype.createTypedArray(s,I),0),l.addSkirtIndices(d,c,h,u,o,I,a),g=n[t]={indices:I,westIndicesSouthToNorth:d,southIndicesEastToWest:c,eastIndicesNorthToSouth:h,northIndicesWestToEast:u,indexCountWithoutSkirts:a}),g},l.addSkirtIndices=function(e,t,r,n,i,o,a){a=f(e,i,o,a),a=f(t,i+=e.length,o,a),a=f(r,i+=t.length,o,a),f(n,i+=r.length,o,a)},l.heightmapTerrainQuality=.25,l.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*l.heightmapTerrainQuality/(t*r)},l.prototype.requestTileGeometry=a.DeveloperError.throwInstantiationError,l.prototype.getLevelMaximumGeometricError=a.DeveloperError.throwInstantiationError,l.prototype.getTileDataAvailable=a.DeveloperError.throwInstantiationError,l.prototype.loadTileDataAvailability=a.DeveloperError.throwInstantiationError;var y=32767,v=new t.Cartesian3,N=new t.Cartesian3,w=new t.Cartesian3,b=new t.Cartographic,S=new t.Cartesian2;function M(e,r,n,i,a,s,d,c,h){var u=Number.POSITIVE_INFINITY,I=a.north,l=a.south,g=a.east,m=a.west;g<m&&(g+=o.CesiumMath.TWO_PI);for(var T=e.length,E=0;E<T;++E){var p=n[f=e[E]],f=i[f];b.longitude=o.CesiumMath.lerp(m,g,f.x),b.latitude=o.CesiumMath.lerp(l,I,f.y),b.height=p-r,p=s.cartographicToCartesian(b,v),t.Matrix4.multiplyByPoint(d,p,p),t.Cartesian3.minimumByComponent(p,c,c),t.Cartesian3.maximumByComponent(p,h,h),u=Math.min(u,b.height)}return u}function x(e,t,n,i,a,s,c,h,u,I,l,g,m,T){var E=r.defined(c),p=u.north,f=u.south,y=u.east,N=u.west;y<N&&(y+=o.CesiumMath.TWO_PI);for(var w=n.length,M=0;M<w;++M){var x=n[M],A=a[x],C=s[x];b.longitude=o.CesiumMath.lerp(N,y,C.x)+m,b.latitude=o.CesiumMath.lerp(f,p,C.y)+T,b.height=A-I;var W,P;A=h.cartographicToCartesian(b,v);E&&(S.x=c[x*=2],S.y=c[1+x]),i.hasWebMercatorT&&(W=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(b.latitude)-l)*g),i.hasGeodeticSurfaceNormals&&(P=h.geodeticSurfaceNormal(A)),t=i.encode(e,t,A,C,b.height,S,W,P)}}function A(e,t){var n;return"function"==typeof e.slice&&"function"!=typeof(n=e.slice()).sort&&(n=void 0),(n=r.defined(n)?n:Array.prototype.slice.call(e)).sort(t),n}return c((function(a,c){var h,u,I=(me=a.quantizedVertices).length/3,g=a.octEncodedNormals,m=a.westIndices.length+a.eastIndices.length+a.southIndices.length+a.northIndices.length,T=a.includeWebMercatorT,E=a.exaggeration,p=a.exaggerationRelativeHeight,f=1!==E,C=t.Rectangle.clone(a.rectangle),W=C.west,P=C.south,D=C.east,k=C.north,F=t.Ellipsoid.clone(a.ellipsoid),H=a.minimumHeight,_=a.maximumHeight,G=a.relativeToCenter,V=s.Transforms.eastNorthUpToFixedFrame(G,F),Y=t.Matrix4.inverseTransformation(V,new t.Matrix4);T&&(h=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(P),u=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k)-h));var O=me.subarray(0,I),B=me.subarray(I,2*I),R=me.subarray(2*I,3*I),L=r.defined(g),j=new Array(I),U=new Array(I),z=new Array(I),q=T?new Array(I):[],Q=f?new Array(I):[],K=N;K.x=Number.POSITIVE_INFINITY,K.y=Number.POSITIVE_INFINITY,K.z=Number.POSITIVE_INFINITY;var X=w;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;for(var Z=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,$=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,te=0;te<I;++te){var re=O[te],ne=B[te],ie=re/y,oe=ne/y;re=o.CesiumMath.lerp(H,_,R[te]/y);b.longitude=o.CesiumMath.lerp(W,D,ie),b.latitude=o.CesiumMath.lerp(P,k,oe),b.height=re,Z=Math.min(b.longitude,Z),J=Math.max(b.longitude,J),$=Math.min(b.latitude,$),ee=Math.max(b.latitude,ee),ne=F.cartographicToCartesian(b),j[te]=new t.Cartesian2(ie,oe),U[te]=re,z[te]=ne,T&&(q[te]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(b.latitude)-h)*u),f&&(Q[te]=F.geodeticSurfaceNormal(ne)),t.Matrix4.multiplyByPoint(Y,ne,v),t.Cartesian3.minimumByComponent(v,K,K),t.Cartesian3.maximumByComponent(v,X,X)}var ae,se=A(a.westIndices,(function(e,t){return j[e].y-j[t].y})),de=A(a.eastIndices,(function(e,t){return j[t].y-j[e].y})),ce=A(a.southIndices,(function(e,t){return j[t].x-j[e].x})),he=A(a.northIndices,(function(e,t){return j[e].x-j[t].x}));H<0&&(ae=new n.EllipsoidalOccluder(F).computeHorizonCullingPointPossiblyUnderEllipsoid(G,z,H));var ue=Math.min(H,M(a.westIndices,a.westSkirtHeight,U,j,C,F,Y,K,X));ue=Math.min(ue,M(a.southIndices,a.southSkirtHeight,U,j,C,F,Y,K,X)),ue=Math.min(ue,M(a.eastIndices,a.eastSkirtHeight,U,j,C,F,Y,K,X)),ue=Math.min(ue,M(a.northIndices,a.northSkirtHeight,U,j,C,F,Y,K,X));for(var Ie,le=new e.AxisAlignedBoundingBox(K,X,G),ge=new n.TerrainEncoding(G,le,ue,_,V,L,T,f,E,p),me=ge.stride,Te=new Float32Array(I*me+m*me),Ee=0,pe=0;pe<I;++pe)L&&(S.x=g[Ie=2*pe],S.y=g[1+Ie]),Ee=ge.encode(Te,Ee,z[pe],j[pe],U[pe],S,q[pe],Q[pe]);return le=Math.max(0,2*(m-4)),ue=a.indices.length+3*le,(V=i.IndexDatatype.createTypedArray(I+m,ue)).set(a.indices,0),le=E=1e-4*(J-Z),ue=-(m=p=1e-4*(ee-$)),x(Te,p=I*me,se,ge,U,j,g,F,C,a.westSkirtHeight,h,u,-E,0),x(Te,p+=a.westIndices.length*me,ce,ge,U,j,g,F,C,a.southSkirtHeight,h,u,0,ue),x(Te,p+=a.southIndices.length*me,de,ge,U,j,g,F,C,a.eastSkirtHeight,h,u,le,0),x(Te,p+=a.eastIndices.length*me,he,ge,U,j,g,F,C,a.northSkirtHeight,h,u,0,m),l.addSkirtIndices(se,ce,de,he,I,V,a.indices.length),c.push(Te.buffer,V.buffer),{vertices:Te.buffer,indices:V.buffer,westIndicesSouthToNorth:se,southIndicesEastToWest:ce,eastIndicesNorthToSouth:de,northIndicesWestToEast:he,vertexStride:me,center:G,minimumHeight:H,maximumHeight:_,occludeePointInScaledSpace:ae,encoding:ge,indexCountWithoutSkirts:a.indices.length}}))}));