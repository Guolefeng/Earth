define(["exports","./AttributeCompression-1f045b73","./Matrix2-ccd5b911","./RuntimeError-346a3079","./when-4bbc8319","./ComponentDatatype-93750d1a","./Transforms-d5c6ad6e","./EncodedCartesian3-08b8d980","./GeometryAttribute-c30799b8","./IndexDatatype-b7d979a6","./IntersectionTests-4d6f5c54","./Plane-18bb00f8"],(function(e,t,r,a,n,i,s,o,u,p,d,l){"use strict";var y=new r.Cartesian3,f=new r.Cartesian3,v=new r.Cartesian3,c={calculateACMR:function(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=n.defaultValue(e.cacheSize,24),i=t.length;if(!n.defined(r)){r=0;for(var s=0,o=t[s];s<i;)r<o&&(r=o),o=t[++s]}for(var u=[],p=0;p<r+1;p++)u[p]=0;for(var d=a+1,l=0;l<i;++l)d-u[t[l]]>a&&(u[t[l]]=d,++d);return(d-a+1)/(i/3)},tipsify:function(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=n.defaultValue(e.cacheSize,24);function i(e,t,r,a,n,i,s){for(var o,u=-1,p=-1,d=0;d<r.length;){var l=r[d];a[l].numLiveTriangles&&(o=0,(p<(o=n-a[l].timeStamp+2*a[l].numLiveTriangles<=t?n-a[l].timeStamp:o)||-1===p)&&(p=o,u=l)),++d}return-1===u?function(e,t,r){for(;1<=t.length;){var a=t[t.length-1];if(t.splice(t.length-1,1),0<e[a].numLiveTriangles)return a}for(;c<r;){if(0<e[c].numLiveTriangles)return++c-1;++c}return-1}(a,i,s):u}e=t.length;var s=0,o=t[w=0],u=e;if(n.defined(r))s=r+1;else{for(;w<u;)s<o&&(s=o),o=t[++w];if(-1===s)return 0;++s}for(var p=[],d=0;d<s;d++)p[d]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var l=w=0;w<u;)p[t[w]].vertexTriangles.push(l),++p[t[w]].numLiveTriangles,p[t[w+1]].vertexTriangles.push(l),++p[t[w+1]].numLiveTriangles,p[t[w+2]].vertexTriangles.push(l),++p[t[w+2]].numLiveTriangles,++l,w+=3;var y,f=0,v=a+1,c=1,m=[],C=[],h=0,b=[],g=e/3,A=[];for(d=0;d<g;d++)A[d]=!1;for(;-1!==f;){m=[];for(var T,x=(T=p[f]).vertexTriangles.length,P=0;P<x;++P)if(!A[l=T.vertexTriangles[P]]){A[l]=!0;for(var w=l+l+l,S=0;S<3;++S)y=t[w],m.push(y),C.push(y),b[h]=y,++h,--(y=p[y]).numLiveTriangles,v-y.timeStamp>a&&(y.timeStamp=v,++v),++w}f=i(0,a,m,p,v,C,s)}return b}},m={};function C(e,t,r,a,n){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=n,e[t++]=n,e[t]=r}function h(e){var t,r,a={};for(t in e)e.hasOwnProperty(t)&&n.defined(e[t])&&n.defined(e[t].values)&&(r=e[t],a[t]=new u.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}));return a}m.toWireframe=function(e){var t=e.indices;if(n.defined(t)){switch(e.primitiveType){case u.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=p.IndexDatatype.createTypedArray(t,t/3*6),a=0,n=0;n<t;n+=3,a+=6)C(r,a,e[n],e[n+1],e[n+2]);return r}(t);break;case u.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var r=p.IndexDatatype.createTypedArray(t,6*(t-2));C(r,0,e[0],e[1],e[2]);for(var a=6,n=3;n<t;++n,a+=6)C(r,a,e[n-1],e[n],e[n-2]);return r}return new Uint16Array}(t);break;case u.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,r=p.IndexDatatype.createTypedArray(t,6*(t-1)),a=e[0],n=0,i=1;i<t;++i,n+=6)C(r,n,a,e[i],e[i+1]);return r}return new Uint16Array}(t)}e.primitiveType=u.PrimitiveType.LINES}return e},m.createLineSegmentsForVectors=function(e,t,r){t=n.defaultValue(t,"normal"),r=n.defaultValue(r,1e4);for(var a,o=e.attributes.position.values,p=e.attributes[t].values,d=o.length,l=new Float64Array(2*d),y=0,f=0;f<d;f+=3)l[y++]=o[f],l[y++]=o[f+1],l[y++]=o[f+2],l[y++]=o[f]+p[f]*r,l[y++]=o[f+1]+p[f+1]*r,l[y++]=o[f+2]+p[f+2]*r;return e=e.boundingSphere,n.defined(e)&&(a=new s.BoundingSphere(e.center,e.radius+r)),new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})},primitiveType:u.PrimitiveType.LINES,boundingSphere:a})},m.createAttributeLocations=function(e){for(var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,i={},s=0,o=r.length,u=0;u<o;++u){var p=r[u];n.defined(a[p])&&(i[p]=s++)}for(t in a)a.hasOwnProperty(t)&&!n.defined(i[t])&&(i[t]=s++);return i},m.reorderForPreVertexCache=function(e){var t=u.Geometry.computeNumberOfVertices(e),r=e.indices;if(n.defined(r)){for(var a=new Int32Array(t),s=0;s<t;s++)a[s]=-1;for(var o,d=r,l=d.length,y=p.IndexDatatype.createTypedArray(t,l),f=0,v=0,c=0;f<l;)-1!==(o=a[d[f]])?y[v]=o:(a[o=d[f]]=c,y[v]=c,++c),++f,++v;e.indices=y;var m,C=e.attributes;for(m in C)if(C.hasOwnProperty(m)&&n.defined(C[m])&&n.defined(C[m].values)){for(var h=C[m],b=h.values,g=0,A=h.componentsPerAttribute,T=i.ComponentDatatype.createTypedArray(h.componentDatatype,c*A);g<t;){var x=a[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},m.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===u.PrimitiveType.TRIANGLES&&n.defined(r)){for(var a=r.length,i=0,s=0;s<a;s++)r[s]>i&&(i=r[s]);e.indices=c.tipsify({indices:r,maximumIndex:i,cacheSize:t})}return e},m.fitToUnsignedShortIndices=function(e){var t=[],r=u.Geometry.computeNumberOfVertices(e);if(n.defined(e.indices)&&r>=i.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,s=[],o=[],p=0,d=h(e.attributes),l=e.indices,y=l.length;e.primitiveType===u.PrimitiveType.TRIANGLES?a=3:e.primitiveType===u.PrimitiveType.LINES?a=2:e.primitiveType===u.PrimitiveType.POINTS&&(a=1);for(var f=0;f<y;f+=a){for(var v=0;v<a;++v){var c=l[f+v],m=s[c];n.defined(m)||(m=p++,s[c]=m,function(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&n.defined(t[a])&&n.defined(t[a].values))for(var i=t[a],s=0;s<i.componentsPerAttribute;++s)e[a].values.push(i.values[r*i.componentsPerAttribute+s])}(d,e.attributes,c)),o.push(m)}p+a>=i.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],o=[],p=0,d=h(e.attributes))}0!==o.length&&t.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var b=new r.Cartesian3,g=new r.Cartographic;m.projectTo2D=function(e,t,a,o,p){for(var d=e.attributes[t],l=(p=n.defined(p)?p:new s.GeographicProjection).ellipsoid,y=d.values,f=new Float64Array(y.length),v=0,c=0;c<y.length;c+=3){var m=r.Cartesian3.fromArray(y,c,b);m=l.cartesianToCartographic(m,g),m=p.project(m,b);f[v++]=m.x,f[v++]=m.y,f[v++]=m.z}return e.attributes[a]=d,e.attributes[o]=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f}),delete e.attributes[t],e};var A={high:0,low:0};m.encodeAttribute=function(e,t,r,a){for(var n=e.attributes[t],s=n.values,p=s.length,d=new Float32Array(p),l=new Float32Array(p),y=0;y<p;++y)o.EncodedCartesian3.encode(s[y],A),d[y]=A.high,l[y]=A.low;return n=n.componentsPerAttribute,e.attributes[r]=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:n,values:d}),e.attributes[a]=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:n,values:l}),delete e.attributes[t],e};var T=new r.Cartesian3;function x(e,t){if(n.defined(t))for(var a=t.values,i=a.length,s=0;s<i;s+=3)r.Cartesian3.unpack(a,s,T),r.Matrix4.multiplyByPoint(e,T,T),r.Cartesian3.pack(T,a,s)}function P(e,t){if(n.defined(t))for(var a=t.values,i=a.length,s=0;s<i;s+=3)r.Cartesian3.unpack(a,s,T),r.Matrix3.multiplyByVector(e,T,T),T=r.Cartesian3.normalize(T,T),r.Cartesian3.pack(T,a,s)}var w=new r.Matrix4,S=new r.Matrix3;m.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(r.Matrix4.equals(t,r.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;return x(t,a.position),x(t,a.prevPosition),x(t,a.nextPosition),(n.defined(a.normal)||n.defined(a.tangent)||n.defined(a.bitangent))&&(r.Matrix4.inverse(t,w),r.Matrix4.transpose(w,w),r.Matrix4.getMatrix3(w,S),P(S,a.normal),P(S,a.tangent),P(S,a.bitangent)),a=e.geometry.boundingSphere,n.defined(a)&&(e.geometry.boundingSphere=s.BoundingSphere.transform(a,t,a)),e.modelMatrix=r.Matrix4.clone(r.Matrix4.IDENTITY),e};var I=new r.Cartesian3;function O(e,t){var a,o,d=e.length;e[0].modelMatrix;var l,y,f,v=n.defined(e[0][t].indices),c=e[0][t].primitiveType,m=function(e,t){var r,a=e.length,s={},o=e[0][t].attributes;for(r in o)if(o.hasOwnProperty(r)&&n.defined(o[r])&&n.defined(o[r].values)){for(var p=o[r],d=p.values.length,l=!0,y=1;y<a;++y){var f=e[y][t].attributes[r];if(!n.defined(f)||p.componentDatatype!==f.componentDatatype||p.componentsPerAttribute!==f.componentsPerAttribute||p.normalize!==f.normalize){l=!1;break}d+=f.values.length}l&&(s[r]=new u.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:i.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return s}(e,t);for(a in m)if(m.hasOwnProperty(a))for(l=m[a].values,h=w=0;h<d;++h)for(f=(y=e[h][t].attributes[a].values).length,o=0;o<f;++o)l[w++]=y[o];if(v){for(var C=0,h=0;h<d;++h)C+=e[h][t].indices.length;var b=u.Geometry.computeNumberOfVertices(new u.Geometry({attributes:m,primitiveType:u.PrimitiveType.POINTS})),g=p.IndexDatatype.createTypedArray(b,C),A=0,T=0;for(h=0;h<d;++h){for(var x=e[h][t].indices,P=x.length,w=0;w<P;++w)g[A++]=T+x[w];T+=u.Geometry.computeNumberOfVertices(e[h][t])}b=g}var S=new r.Cartesian3,O=0;for(h=0;h<d;++h){if(E=e[h][t].boundingSphere,!n.defined(E)){S=void 0;break}r.Cartesian3.add(E.center,S,S)}if(n.defined(S))for(r.Cartesian3.divideByScalar(S,d,S),h=0;h<d;++h){var E=e[h][t].boundingSphere,N=r.Cartesian3.magnitude(r.Cartesian3.subtract(E.center,S,I))+E.radius;O<N&&(O=N)}return new u.Geometry({attributes:m,indices:b,primitiveType:c,boundingSphere:n.defined(S)?new s.BoundingSphere(S,O):void 0})}m.combineInstances=function(e){for(var t=[],r=[],a=e.length,i=0;i<a;++i){var s=e[i];n.defined(s.geometry)?t.push(s):n.defined(s.westHemisphereGeometry)&&n.defined(s.eastHemisphereGeometry)&&r.push(s)}var o=[];return 0<t.length&&o.push(O(t,"geometry")),0<r.length&&(o.push(O(r,"westHemisphereGeometry")),o.push(O(r,"eastHemisphereGeometry"))),o};var E=new r.Cartesian3,N=new r.Cartesian3,L=new r.Cartesian3,z=new r.Cartesian3;m.computeNormal=function(e){for(var t=e.indices,a=e.attributes,n=a.position.values,s=a.position.values.length/3,o=t.length,p=new Array(s),d=new Array(o/3),l=new Array(o),y=0;y<s;y++)p[y]={indexOffset:0,count:0,currentCount:0};var f=0;for(y=0;y<o;y+=3){var v=t[y],c=t[y+1],m=t[y+2],C=3*v,h=3*c,b=3*m;N.x=n[C],N.y=n[1+C],N.z=n[2+C],L.x=n[h],L.y=n[1+h],L.z=n[2+h],z.x=n[b],z.y=n[1+b],z.z=n[2+b],p[v].count++,p[c].count++,p[m].count++,r.Cartesian3.subtract(L,N,L),r.Cartesian3.subtract(z,N,z),d[f]=r.Cartesian3.cross(L,z,new r.Cartesian3),f++}var g,A=0;for(y=0;y<s;y++)p[y].indexOffset+=A,A+=p[y].count;for(y=f=0;y<o;y+=3)l[(g=p[t[y]]).indexOffset+g.currentCount]=f,g.currentCount++,l[(g=p[t[y+1]]).indexOffset+g.currentCount]=f,g.currentCount++,l[(g=p[t[y+2]]).indexOffset+g.currentCount]=f,g.currentCount++,f++;var T=new Float32Array(3*s);for(y=0;y<s;y++){var x=3*y;if(g=p[y],r.Cartesian3.clone(r.Cartesian3.ZERO,E),0<g.count){for(f=0;f<g.count;f++)r.Cartesian3.add(E,d[l[g.indexOffset+f]],E);r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,E,i.CesiumMath.EPSILON10)&&r.Cartesian3.clone(d[l[g.indexOffset]],E)}r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,E,i.CesiumMath.EPSILON10)&&(E.z=1),r.Cartesian3.normalize(E,E),T[x]=E.x,T[1+x]=E.y,T[2+x]=E.z}return e.attributes.normal=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T}),e};var D=new r.Cartesian3,M=new r.Cartesian3,G=new r.Cartesian3;m.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,a=e.attributes.position.values,n=e.attributes.normal.values,s=e.attributes.st.values,o=e.attributes.position.values.length/3,p=t.length,d=new Array(3*o),l=0;l<d.length;l++)d[l]=0;for(l=0;l<p;l+=3){var y,f=t[l],v=3*(A=t[l+1]),c=3*(T=t[l+2]),m=2*f,C=2*A,h=2*T,b=a[y=3*f],g=a[y+1],A=a[y+2],T=s[m];f=s[1+m],m=s[1+C]-f,f=s[1+h]-f,T=1/((s[C]-T)*f-(s[h]-T)*m),b=(f*(a[v]-b)-m*(a[c]-b))*T,g=(f*(a[v+1]-g)-m*(a[c+1]-g))*T,T=(f*(a[v+2]-A)-m*(a[c+2]-A))*T;d[y]+=b,d[y+1]+=g,d[y+2]+=T,d[v]+=b,d[v+1]+=g,d[v+2]+=T,d[c]+=b,d[c+1]+=g,d[c+2]+=T}var x=new Float32Array(3*o),P=new Float32Array(3*o);for(l=0;l<o;l++){v=1+(y=3*l),c=y+2;var w=r.Cartesian3.fromArray(n,y,D),S=r.Cartesian3.fromArray(d,y,G),I=r.Cartesian3.dot(w,S);r.Cartesian3.multiplyByScalar(w,I,M),r.Cartesian3.normalize(r.Cartesian3.subtract(S,M,S),S),x[y]=S.x,x[v]=S.y,x[c]=S.z,r.Cartesian3.normalize(r.Cartesian3.cross(w,S,S),S),P[y]=S.x,P[v]=S.y,P[c]=S.z}return e.attributes.tangent=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}),e.attributes.bitangent=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),e};var R=new r.Cartesian2,V=new r.Cartesian3,F=new r.Cartesian3,B=new r.Cartesian3,_=new r.Cartesian2;function k(e,t){Math.abs(e.y)<i.CesiumMath.EPSILON6&&(e.y=t?-i.CesiumMath.EPSILON6:i.CesiumMath.EPSILON6)}m.compressVertices=function(e){var a=e.attributes.extrudeDirection;if(n.defined(a)){for(var s=a.values,o=s.length/3,p=new Float32Array(2*o),d=0,l=0;l<o;++l)r.Cartesian3.fromArray(s,3*l,V),r.Cartesian3.equals(V,r.Cartesian3.ZERO)?d+=2:(_=t.AttributeCompression.octEncodeInRange(V,65535,_),p[d++]=_.x,p[d++]=_.y);return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:p}),delete e.attributes.extrudeDirection,e}var y=e.attributes.normal,f=e.attributes.st,v=n.defined(y),c=n.defined(f);if(!v&&!c)return e;var m,C,h,b,g=e.attributes.tangent,A=(a=e.attributes.bitangent,n.defined(g)),T=n.defined(a);v&&(m=y.values),c&&(C=f.values),A&&(h=g.values),T&&(b=a.values),g=o=(v?m:C).length/(v?3:2),a=c&&v?2:1,g*=a+=A||T?1:0;var x=new Float32Array(g),P=0;for(l=0;l<o;++l){c&&(r.Cartesian2.fromArray(C,2*l,R),x[P++]=t.AttributeCompression.compressTextureCoordinates(R));var w=3*l;v&&n.defined(h)&&n.defined(b)?(r.Cartesian3.fromArray(m,w,V),r.Cartesian3.fromArray(h,w,F),r.Cartesian3.fromArray(b,w,B),t.AttributeCompression.octPack(V,F,B,R),x[P++]=R.x,x[P++]=R.y):(v&&(r.Cartesian3.fromArray(m,w,V),x[P++]=t.AttributeCompression.octEncodeFloat(V)),A&&(r.Cartesian3.fromArray(h,w,V),x[P++]=t.AttributeCompression.octEncodeFloat(V)),T&&(r.Cartesian3.fromArray(b,w,V),x[P++]=t.AttributeCompression.octEncodeFloat(V)))}return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:a,values:x}),v&&delete e.attributes.normal,c&&delete e.attributes.st,T&&delete e.attributes.bitangent,A&&delete e.attributes.tangent,e};var q=new r.Cartesian3;function U(e,t,a,n){r.Cartesian3.add(e,r.Cartesian3.multiplyByScalar(r.Cartesian3.subtract(t,e,q),e.y/(e.y-t.y),q),a),r.Cartesian3.clone(a,n),k(a,!0),k(n,!1)}var Y=new r.Cartesian3,Z=new r.Cartesian3,H=new r.Cartesian3,W=new r.Cartesian3,X={positions:new Array(7),indices:new Array(9)};function j(e,t,r){if(!(0<=e.x||0<=t.x||0<=r.x)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return k(e,e.y<0),k(t,t.y<0),k(r,r.y<0);var a=Math.abs(e.y),n=Math.abs(t.y),s=Math.abs(r.y);k(e,n=(n=n<a?s<a?i.CesiumMath.sign(e.y):i.CesiumMath.sign(r.y):s<n?i.CesiumMath.sign(t.y):i.CesiumMath.sign(r.y))<0),k(t,n),k(r,n)}(e,t,r);var a=e.y<0,n=t.y<0,s=r.y<0,o=0;o+=a?1:0,o+=n?1:0;var u=X.indices;return 1==(o+=s?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,a?(U(e,t,Y,H),U(e,r,Z,W),u[0]=0,u[3]=1,u[4]=2,u[6]=1):n?(U(t,r,Y,H),U(t,e,Z,W),u[0]=1,u[3]=2,u[4]=0,u[6]=2):s&&(U(r,e,Y,H),U(r,t,Z,W),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2==o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,a?n?s||(U(r,e,Y,H),U(r,t,Z,W),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(U(t,r,Y,H),U(t,e,Z,W),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(U(e,t,Y,H),U(e,r,Z,W),u[0]=1,u[1]=2,u[3]=1,u[6]=0)),(u=X.positions)[0]=e,u[1]=t,u[2]=r,u.length=3,1!=o&&2!=o||(u[3]=Y,u[4]=Z,u[5]=H,u[6]=W,u.length=7),X}}function J(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var a in r)r.hasOwnProperty(a)&&n.defined(r[a])&&n.defined(r[a].values)&&((a=r[a]).values=i.ComponentDatatype.createTypedArray(a.componentDatatype,a.values));var o=u.Geometry.computeNumberOfVertices(e);return e.indices=p.IndexDatatype.createTypedArray(o,e.indices),t&&(e.boundingSphere=s.BoundingSphere.fromVertices(r.position.values)),e}}function K(e){var t,r,a=e.attributes,i={};for(t in a)a.hasOwnProperty(t)&&n.defined(a[t])&&n.defined(a[t].values)&&(r=a[t],i[t]=new u.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}));return new u.Geometry({attributes:i,indices:[],primitiveType:e.primitiveType})}function Q(e,t,r){var a=n.defined(e.geometry.boundingSphere);t=J(t,a),r=J(r,a),n.defined(r)&&!n.defined(t)?e.geometry=r:!n.defined(r)&&n.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function $(e,t){var r=new e,a=new e,n=new e;return function(i,s,o,u,p,d,l,y){i=e.fromArray(p,i*t,r),s=e.fromArray(p,s*t,a),o=e.fromArray(p,o*t,n),e.multiplyByScalar(i,u.x,i),e.multiplyByScalar(s,u.y,s),e.multiplyByScalar(o,u.z,o),i=e.add(i,s,i),e.add(i,o,i),y&&e.normalize(i,i),e.pack(i,d,l*t)}}var ee=$(r.Cartesian4,4),te=$(r.Cartesian3,3),re=$(r.Cartesian2,2),ae=new r.Cartesian3,ne=new r.Cartesian3,ie=new r.Cartesian3,se=new r.Cartesian3;function oe(e,t,a,s,o,u,p,d,l,c,m,C,h,b,g,A){if(n.defined(u)||n.defined(p)||n.defined(d)||n.defined(l)||n.defined(c)||0!==b){var T,x=function(e,t,a,s,o){var u,p,d,l,c,m,C;if(n.defined(o)||(o=new r.Cartesian3),n.defined(t.z)){if(r.Cartesian3.equalsEpsilon(e,t,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian3.equalsEpsilon(e,a,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian3.equalsEpsilon(e,s,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian3.subtract(a,t,y),p=r.Cartesian3.subtract(s,t,f),d=r.Cartesian3.subtract(e,t,v),l=r.Cartesian3.dot(u,u),h=r.Cartesian3.dot(u,p),c=r.Cartesian3.dot(u,d),m=r.Cartesian3.dot(p,p),C=r.Cartesian3.dot(p,d)}else{if(r.Cartesian2.equalsEpsilon(e,t,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian2.equalsEpsilon(e,a,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian2.equalsEpsilon(e,s,i.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian2.subtract(a,t,y),p=r.Cartesian2.subtract(s,t,f),d=r.Cartesian2.subtract(e,t,v),l=r.Cartesian2.dot(u,u),h=r.Cartesian2.dot(u,p),c=r.Cartesian2.dot(u,d),m=r.Cartesian2.dot(p,p),C=r.Cartesian2.dot(p,d)}o.y=m*c-h*C,o.z=l*C-h*c;var h=l*m-h*h;return 0!==o.y&&(o.y/=h),0!==o.z&&(o.z/=h),o.x=1-o.y-o.z,o}(s,r.Cartesian3.fromArray(o,3*e,ae),r.Cartesian3.fromArray(o,3*t,ne),r.Cartesian3.fromArray(o,3*a,ie),se);if(n.defined(u)&&te(e,t,a,x,u,C.normal.values,A,!0),n.defined(c)&&(o=r.Cartesian3.fromArray(c,3*e,ae),u=r.Cartesian3.fromArray(c,3*t,ne),c=r.Cartesian3.fromArray(c,3*a,ie),r.Cartesian3.multiplyByScalar(o,x.x,o),r.Cartesian3.multiplyByScalar(u,x.y,u),r.Cartesian3.multiplyByScalar(c,x.z,c),r.Cartesian3.equals(o,r.Cartesian3.ZERO)&&r.Cartesian3.equals(u,r.Cartesian3.ZERO)&&r.Cartesian3.equals(c,r.Cartesian3.ZERO)?((T=ae).x=0,T.y=0,T.z=0):(T=r.Cartesian3.add(o,u,o),r.Cartesian3.add(T,c,T),r.Cartesian3.normalize(T,T)),r.Cartesian3.pack(T,C.extrudeDirection.values,3*A)),n.defined(m)&&function(e,t,r,a,n,s,o){e=n[e]*a.x,t=n[t]*a.y,a=n[r]*a.z,s[o]=e+t+a>i.CesiumMath.EPSILON6?1:0}(e,t,a,x,m,C.applyOffset.values,A),n.defined(p)&&te(e,t,a,x,p,C.tangent.values,A,!0),n.defined(d)&&te(e,t,a,x,d,C.bitangent.values,A,!0),n.defined(l)&&re(e,t,a,x,l,C.st.values,A),0<b)for(var P=0;P<b;P++){var w=h[P];!function(e,t,r,a,n,i,s){var o=i.componentsPerAttribute,u=i.values,p=s.values;switch(o){case 4:ee(e,t,r,a,u,p,n,!1);break;case 3:te(e,t,r,a,u,p,n,!1);break;case 2:re(e,t,r,a,u,p,n,!1);break;default:p[n]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}(e,t,a,x,A,g[w],C[w])}}}function ue(e,t,r,a,n,i){var s=e.position.values.length/3;return-1===n?(e.position.values.push(i.x,i.y,i.z),t.push(s),s):-1===(n=r[a=a[n]])?(r[a]=s,e.position.values.push(i.x,i.y,i.z),t.push(s),s):(t.push(n),n)}var pe={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function de(e){var t,a=e.geometry,i=a.attributes,s=i.position.values,o=n.defined(i.normal)?i.normal.values:void 0,u=n.defined(i.bitangent)?i.bitangent.values:void 0,p=n.defined(i.tangent)?i.tangent.values:void 0,d=n.defined(i.st)?i.st.values:void 0,l=n.defined(i.extrudeDirection)?i.extrudeDirection.values:void 0,y=n.defined(i.applyOffset)?i.applyOffset.values:void 0,f=a.indices,v=[];for(t in i)i.hasOwnProperty(t)&&!pe[t]&&n.defined(i[t])&&v.push(t);var c,m,C=v.length,h=K(a),b=K(a),g=[];g.length=s.length/3;var A=[];for(A.length=s.length/3,x=0;x<g.length;++x)g[x]=-1,A[x]=-1;for(var T=f.length,x=0;x<T;x+=3){var P=f[x],w=f[x+1],S=f[x+2],I=r.Cartesian3.fromArray(s,3*P),O=r.Cartesian3.fromArray(s,3*w),E=r.Cartesian3.fromArray(s,3*S),N=j(I,O,E);if(n.defined(N)&&3<N.positions.length)for(var L=N.positions,z=N.indices,D=z.length,M=0;M<D;++M){var G=z[M],R=L[G],V=R.y<0?(c=b.attributes,m=b.indices,g):(c=h.attributes,m=h.indices,A);oe(P,w,S,R,s,o,p,u,d,l,y,c,v,C,i,ue(c,m,V,f,G<3?x+G:-1,R))}else n.defined(N)&&(I=N.positions[0],O=N.positions[1],E=N.positions[2]),V=I.y<0?(c=b.attributes,m=b.indices,g):(c=h.attributes,m=h.indices,A),oe(P,w,S,I,s,o,p,u,d,l,y,c,v,C,i,ue(c,m,V,f,x,I)),oe(P,w,S,O,s,o,p,u,d,l,y,c,v,C,i,ue(c,m,V,f,x+1,O)),oe(P,w,S,E,s,o,p,u,d,l,y,c,v,C,i,ue(c,m,V,f,x+2,E))}Q(e,b,h)}var le=l.Plane.fromPointNormal(r.Cartesian3.ZERO,r.Cartesian3.UNIT_Y),ye=new r.Cartesian3,fe=new r.Cartesian3;function ve(e,t,a,s,o,u,p){n.defined(p)&&(s=r.Cartesian3.fromArray(s,3*e,ae),r.Cartesian3.equalsEpsilon(s,a,i.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[t])}function ce(e){var t,a=e.geometry,s=a.attributes,o=s.position.values,u=n.defined(s.applyOffset)?s.applyOffset.values:void 0,p=a.indices,l=K(a),y=K(a),f=p.length,v=[];v.length=o.length/3;var c=[];for(c.length=o.length/3,t=0;t<v.length;++t)v[t]=-1,c[t]=-1;for(t=0;t<f;t+=2){var m=p[t],C=p[t+1],h=r.Cartesian3.fromArray(o,3*m,ae),b=r.Cartesian3.fromArray(o,3*C,ne);Math.abs(h.y)<i.CesiumMath.EPSILON6&&(h.y<0?h.y=-i.CesiumMath.EPSILON6:h.y=i.CesiumMath.EPSILON6),Math.abs(b.y)<i.CesiumMath.EPSILON6&&(b.y<0?b.y=-i.CesiumMath.EPSILON6:b.y=i.CesiumMath.EPSILON6);var g,A,T,x,P=l.attributes,w=l.indices,S=c,I=y.attributes,O=y.indices,E=v,N=d.IntersectionTests.lineSegmentPlane(h,b,le,ie);n.defined(N)?(g=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,5*i.CesiumMath.EPSILON9,ye),h.y<0&&(r.Cartesian3.negate(g,g),P=y.attributes,w=y.indices,S=v,I=l.attributes,O=l.indices,E=c),A=r.Cartesian3.add(N,g,fe),ve(m,C,h,o,ue(P,w,S,p,t,h),P,u),ve(m,C,A,o,ue(P,w,S,p,-1,A),P,u),r.Cartesian3.negate(g,g),r.Cartesian3.add(N,g,A),ve(m,C,A,o,ue(I,O,E,p,-1,A),I,u),ve(m,C,b,o,ue(I,O,E,p,t+1,b),I,u)):(I=h.y<0?(T=y.attributes,x=y.indices,v):(T=l.attributes,x=l.indices,c),ve(m,C,h,o,ue(T,x,I,p,t,h),T,u),ve(m,C,b,o,ue(T,x,I,p,t+1,b),T,u))}Q(e,y,l)}var me=new r.Cartesian2,Ce=new r.Cartesian2,he=new r.Cartesian3,be=new r.Cartesian3,ge=new r.Cartesian3,Ae=new r.Cartesian3,Te=new r.Cartesian3,xe=new r.Cartesian3,Pe=new r.Cartesian4;function we(e){for(var t=(e=e.attributes).position.values,a=e.prevPosition.values,n=e.nextPosition.values,i=t.length,s=0;s<i;s+=3){var o,u=r.Cartesian3.unpack(t,s,he);0<u.x||(o=r.Cartesian3.unpack(a,s,be),(u.y<0&&0<o.y||0<u.y&&o.y<0)&&(0<s-3?(a[s]=t[s-3],a[s+1]=t[s-2],a[s+2]=t[s-1]):r.Cartesian3.pack(u,a,s)),o=r.Cartesian3.unpack(n,s,ge),(u.y<0&&0<o.y||0<u.y&&o.y<0)&&(s+3<i?(n[s]=t[s+3],n[s+1]=t[s+4],n[s+2]=t[s+5]):r.Cartesian3.pack(u,n,s)))}}var Se=5*i.CesiumMath.EPSILON9,Ie=i.CesiumMath.EPSILON6;m.splitLongitude=function(e){var t=e.geometry,a=t.boundingSphere;if(n.defined(a)&&(0<a.center.x-a.radius||s.BoundingSphere.intersectPlane(a,l.Plane.ORIGIN_ZX_PLANE)!==s.Intersect.INTERSECTING))return e;if(t.geometryType!==u.GeometryType.NONE)switch(t.geometryType){case u.GeometryType.POLYLINES:!function(e){for(var t=e.geometry,a=t.attributes,s=a.position.values,o=a.prevPosition.values,u=a.nextPosition.values,p=a.expandAndWidth.values,l=n.defined(a.st)?a.st.values:void 0,y=n.defined(a.color)?a.color.values:void 0,f=K(t),v=K(t),c=!1,m=s.length/3,C=0;C<m;C+=4){var h=C,b=C+2,g=r.Cartesian3.fromArray(s,3*h,he),A=r.Cartesian3.fromArray(s,3*b,be);if(Math.abs(g.y)<Ie)for(g.y=Ie*(A.y<0?-1:1),s[3*C+1]=g.y,s[3*(C+1)+1]=g.y,z=3*h;z<3*h+12;z+=3)o[z]=s[3*C],o[z+1]=s[3*C+1],o[z+2]=s[3*C+2];if(Math.abs(A.y)<Ie)for(A.y=Ie*(g.y<0?-1:1),s[3*(C+2)+1]=A.y,s[3*(C+3)+1]=A.y,z=3*h;z<3*h+12;z+=3)u[z]=s[3*(C+2)],u[z+1]=s[3*(C+2)+1],u[z+2]=s[3*(C+2)+2];var T=f.attributes,x=f.indices,P=v.attributes,w=v.indices,S=d.IntersectionTests.lineSegmentPlane(g,A,le,Ae);if(n.defined(S)){c=!0;var I=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,Se,Te);g.y<0&&(r.Cartesian3.negate(I,I),T=v.attributes,x=v.indices,P=f.attributes,w=f.indices);var O=r.Cartesian3.add(S,I,xe);T.position.values.push(g.x,g.y,g.z,g.x,g.y,g.z),T.position.values.push(O.x,O.y,O.z),T.position.values.push(O.x,O.y,O.z),T.prevPosition.values.push(o[3*h],o[3*h+1],o[3*h+2]),T.prevPosition.values.push(o[3*h+3],o[3*h+4],o[3*h+5]),T.prevPosition.values.push(g.x,g.y,g.z,g.x,g.y,g.z),T.nextPosition.values.push(O.x,O.y,O.z),T.nextPosition.values.push(O.x,O.y,O.z),T.nextPosition.values.push(O.x,O.y,O.z),T.nextPosition.values.push(O.x,O.y,O.z),r.Cartesian3.negate(I,I),r.Cartesian3.add(S,I,O),P.position.values.push(O.x,O.y,O.z),P.position.values.push(O.x,O.y,O.z),P.position.values.push(A.x,A.y,A.z,A.x,A.y,A.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.nextPosition.values.push(A.x,A.y,A.z,A.x,A.y,A.z),P.nextPosition.values.push(u[3*b],u[3*b+1],u[3*b+2]),P.nextPosition.values.push(u[3*b+3],u[3*b+4],u[3*b+5]);var E=r.Cartesian2.fromArray(p,2*h,me),N=Math.abs(E.y);if(T.expandAndWidth.values.push(-1,N,1,N),T.expandAndWidth.values.push(-1,-N,1,-N),P.expandAndWidth.values.push(-1,N,1,N),P.expandAndWidth.values.push(-1,-N,1,-N),I=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(S,g,ge)),I/=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(A,g,ge)),n.defined(y)){O=r.Cartesian4.fromArray(y,4*h,Pe);for(var L=r.Cartesian4.fromArray(y,4*b,Pe),z=(E=i.CesiumMath.lerp(O.x,L.x,I),N=i.CesiumMath.lerp(O.y,L.y,I),S=i.CesiumMath.lerp(O.z,L.z,I),L=i.CesiumMath.lerp(O.w,L.w,I),4*h);z<4*h+8;++z)T.color.values.push(y[z]);for(T.color.values.push(E,N,S,L),T.color.values.push(E,N,S,L),P.color.values.push(E,N,S,L),P.color.values.push(E,N,S,L),z=4*b;z<4*b+8;++z)P.color.values.push(y[z])}if(n.defined(l)){L=r.Cartesian2.fromArray(l,2*h,me);var D=r.Cartesian2.fromArray(l,2*(C+3),Ce);I=i.CesiumMath.lerp(L.x,D.x,I);for(z=2*h;z<2*h+4;++z)T.st.values.push(l[z]);for(T.st.values.push(I,L.y),T.st.values.push(I,D.y),P.st.values.push(I,L.y),P.st.values.push(I,D.y),z=2*b;z<2*b+4;++z)P.st.values.push(l[z])}D=T.position.values.length/3-4,x.push(D,D+2,D+1),x.push(D+1,D+2,D+3),D=P.position.values.length/3-4,w.push(D,D+2,D+1),w.push(D+1,D+2,D+3)}else{var M;w=g.y<0?(M=v.attributes,v.indices):(M=f.attributes,f.indices);for(M.position.values.push(g.x,g.y,g.z),M.position.values.push(g.x,g.y,g.z),M.position.values.push(A.x,A.y,A.z),M.position.values.push(A.x,A.y,A.z),z=3*C;z<3*C+12;++z)M.prevPosition.values.push(o[z]),M.nextPosition.values.push(u[z]);for(z=2*C;z<2*C+8;++z)M.expandAndWidth.values.push(p[z]),n.defined(l)&&M.st.values.push(l[z]);if(n.defined(y))for(z=4*C;z<4*C+16;++z)M.color.values.push(y[z]);D=M.position.values.length/3-4,w.push(D,D+2,D+1),w.push(D+1,D+2,D+3)}}c&&(we(v),we(f)),Q(e,v,f)}(e);break;case u.GeometryType.TRIANGLES:de(e);break;case u.GeometryType.LINES:ce(e)}else(function(e){switch(e.primitiveType){case u.PrimitiveType.TRIANGLE_FAN:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,n=3;n<t;++n)r[a++]=n-1,r[a++]=0,r[a++]=n;return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}(e);case u.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,3<t&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,n=3;n<t-1;n+=2)r[a++]=n,r[a++]=n-1,r[a++]=n+1,n+2<t&&(r[a++]=n,r[a++]=n+1,r[a++]=n+2);return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}(e);case u.PrimitiveType.TRIANGLES:return function(e){if(n.defined(e.indices))return e;for(var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e);case u.PrimitiveType.LINE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}(e);case u.PrimitiveType.LINE_LOOP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}(e);case u.PrimitiveType.LINES:return function(e){if(n.defined(e.indices))return e;for(var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e)}})(t),t.primitiveType===u.PrimitiveType.TRIANGLES?de(e):t.primitiveType===u.PrimitiveType.LINES&&ce(e);return e},e.GeometryPipeline=m}));