define(["exports","./Matrix2-ccd5b911","./when-4bbc8319","./RuntimeError-346a3079","./EllipsoidGeodesic-19ea7553","./EllipsoidRhumbLine-aa9e6266","./IntersectionTests-4d6f5c54","./ComponentDatatype-93750d1a","./Plane-18bb00f8"],(function(a,e,r,t,n,i,o,s,c){"use strict";var l={numberOfPoints:function(a,r,t){return r=e.Cartesian3.distance(a,r),Math.ceil(r/t)},numberOfPointsRhumbLine:function(a,e,r){return e=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2),Math.max(1,Math.ceil(Math.sqrt(e/(r*r))))}},u=new e.Cartographic;l.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,u).height}return t};var h=new e.Matrix4,g=new e.Cartesian3,f=new e.Cartesian3,C=new c.Plane(e.Cartesian3.UNIT_X,0),p=new e.Cartesian3,d=new c.Plane(e.Cartesian3.UNIT_X,0),m=new e.Cartesian3,v=new e.Cartesian3,w=[];function P(a,e,r){var t=w;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++)t[i]=e+i*n;return t}var T=new e.Cartographic,y=new e.Cartographic,A=new e.Cartesian3,b=new e.Cartesian3,E=new e.Cartesian3,R=new n.EllipsoidGeodesic,M=new i.EllipsoidRhumbLine;l.wrapLongitude=function(a,t){var n=[],i=[];if(r.defined(a)&&0<a.length){t=r.defaultValue(t,e.Matrix4.IDENTITY);var s=e.Matrix4.inverseTransformation(t,h),l=(t=e.Matrix4.multiplyByPoint(s,e.Cartesian3.ZERO,g),e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_Y,f),f)),u=c.Plane.fromPointNormal(t,l,C),w=(s=e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_X,p),p),c.Plane.fromPointNormal(t,s,d)),P=1;n.push(e.Cartesian3.clone(a[0]));for(var T=n[0],y=a.length,A=1;A<y;++A){var b,E,R=a[A];(c.Plane.getPointDistance(w,T)<0||c.Plane.getPointDistance(w,R)<0)&&(b=o.IntersectionTests.lineSegmentPlane(T,R,u,m),r.defined(b)&&(E=e.Cartesian3.multiplyByScalar(l,5e-9,v),c.Plane.getPointDistance(u,T)<0&&e.Cartesian3.negate(E,E),n.push(e.Cartesian3.add(b,E,new e.Cartesian3)),i.push(P+1),e.Cartesian3.negate(E,E),n.push(e.Cartesian3.add(b,E,new e.Cartesian3)),P=1)),n.push(e.Cartesian3.clone(a[A])),P++,T=R}i.push(P)}return{positions:n,lengths:i}},l.generateArc=function(a){var t=(a=r.defined(a)?a:{}).positions,n=t.length,i=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),o=r.defaultValue(a.height,0),c=Array.isArray(o);if(n<1)return[];if(1===n){var u,h=i.scaleToGeodeticSurface(t[0],b);return 0!==(o=c?o[0]:o)&&(u=i.geodeticSurfaceNormal(h,A),e.Cartesian3.multiplyByScalar(u,o,u),e.Cartesian3.add(h,u,h)),[h.x,h.y,h.z]}var g=a.minDistance;r.defined(g)||(m=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE),g=s.CesiumMath.chordLength(m,i.maximumRadius));for(var f=0,C=0;C<n-1;C++)f+=l.numberOfPoints(t[C],t[C+1],g);a=3*(f+1);var p=new Array(a),d=0;for(C=0;C<n-1;C++)d=function(a,r,t,n,i,o,s,c){var u=n.scaleToGeodeticSurface(a,b),h=n.scaleToGeodeticSurface(r,E),g=l.numberOfPoints(a,r,t),f=(u=n.cartesianToCartographic(u,T),h=n.cartesianToCartographic(h,y),P(g,i,o));R.setEndPoints(u,h);var C=R.surfaceDistance/g,p=c;u.height=i;var d=n.cartographicToCartesian(u,A);e.Cartesian3.pack(d,s,p),p+=3;for(var m=1;m<g;m++){var v=R.interpolateUsingSurfaceDistance(m*C,y);v.height=f[m],d=n.cartographicToCartesian(v,A),e.Cartesian3.pack(d,s,p),p+=3}return p}(t[C],t[C+1],g,i,c?o[C]:o,c?o[C+1]:o,p,d);w.length=0;var m=t[n-1];return(m=i.cartesianToCartographic(m,T)).height=c?o[n-1]:o,m=i.cartographicToCartesian(m,A),e.Cartesian3.pack(m,p,a-3),p};var S=new e.Cartographic,D=new e.Cartographic;l.generateRhumbArc=function(a){var t=(a=r.defined(a)?a:{}).positions,n=t.length,o=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),c=r.defaultValue(a.height,0),u=Array.isArray(c);if(n<1)return[];if(1===n){var h,g=o.scaleToGeodeticSurface(t[0],b);return 0!==(c=u?c[0]:c)&&(h=o.geodeticSurfaceNormal(g,A),e.Cartesian3.multiplyByScalar(h,c,h),e.Cartesian3.add(g,h,g)),[g.x,g.y,g.z]}for(var f,C=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE),p=0,d=o.cartesianToCartographic(t[0],S),m=0;m<n-1;m++)f=o.cartesianToCartographic(t[m+1],D),p+=l.numberOfPointsRhumbLine(d,f,C),d=e.Cartographic.clone(f,S);g=3*(p+1);var v=new Array(g),E=0;for(m=0;m<n-1;m++)E=function(a,r,t,n,o,s,c,u){a=n.cartesianToCartographic(a,T),r=n.cartesianToCartographic(r,y);var h=l.numberOfPointsRhumbLine(a,r,t);a.height=0,r.height=0;var g=P(h,o,s);(M=M.ellipsoid.equals(n)?M:new i.EllipsoidRhumbLine(void 0,void 0,n)).setEndPoints(a,r);var f=M.surfaceDistance/h,C=u;a.height=o;var p=n.cartographicToCartesian(a,A);e.Cartesian3.pack(p,c,C),C+=3;for(var d=1;d<h;d++){var m=M.interpolateUsingSurfaceDistance(d*f,y);m.height=g[d],p=n.cartographicToCartesian(m,A),e.Cartesian3.pack(p,c,C),C+=3}return C}(t[m],t[m+1],C,o,u?c[m]:c,u?c[m+1]:c,v,E);return w.length=0,a=t[n-1],(a=o.cartesianToCartographic(a,T)).height=u?c[n-1]:c,a=o.cartographicToCartesian(a,A),e.Cartesian3.pack(a,v,g-3),v},l.generateCartesianArc=function(a){for(var r=l.generateArc(a),t=r.length/3,n=new Array(t),i=0;i<t;i++)n[i]=e.Cartesian3.unpack(r,3*i);return n},l.generateCartesianRhumbArc=function(a){for(var r=l.generateRhumbArc(a),t=r.length/3,n=new Array(t),i=0;i<t;i++)n[i]=e.Cartesian3.unpack(r,3*i);return n},a.PolylinePipeline=l}));