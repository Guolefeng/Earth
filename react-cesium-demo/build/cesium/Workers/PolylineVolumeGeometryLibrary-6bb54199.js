define(["exports","./Matrix2-ccd5b911","./EllipsoidTangentPlane-e000bae1","./ComponentDatatype-93750d1a","./PolylinePipeline-8457214f","./Transforms-d5c6ad6e","./when-4bbc8319","./RuntimeError-346a3079"],(function(e,a,r,n,t,i,s,o){"use strict";var l=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),C={};function c(e,a){s.defined(C[e])||(C[e]=!0,console.warn(s.defaultValue(a,e)))}c.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",c.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",c.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",c.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var u=[new a.Cartesian3,new a.Cartesian3],d=new a.Cartesian3,g=new a.Cartesian3,y=new a.Cartesian3,m=new a.Cartesian3,h=new a.Cartesian3,p=new a.Cartesian3,f=new a.Cartesian3,w=new a.Cartesian3,x=new a.Cartesian3,v=new a.Cartesian3,E=new a.Cartesian3,P={},b=new a.Cartographic;function M(e,r,n,t){var i=e[0],s=(e=e[1],e=a.Cartesian3.angleBetween(i,e),Math.ceil(e/t)),o=new Array(s);if(r===n){for(C=0;C<s;C++)o[C]=r;return o.push(n),o}for(var l=(n-r)/s,C=1;C<s;C++)o[C]=r+C*l;return o[0]=r,o.push(n),o}var T=new a.Cartesian3,B=new a.Cartesian3,z=new a.Cartesian3(-1,0,0),S=new a.Matrix4,A=new a.Matrix4,D=new a.Matrix3,R=a.Matrix3.IDENTITY.clone(),O=new a.Cartesian3,I=new a.Cartesian4,V=new a.Cartesian3;function N(e,n,t,s,o,l,C,c){var u=O,d=I;S=i.Transforms.eastNorthUpToFixedFrame(e,o,S),u=a.Matrix4.multiplyByPointAsVector(S,z,u);u=u=a.Cartesian3.normalize(u,u),n=n,e=e,o=o,u=(o=new r.EllipsoidTangentPlane(e,o)).projectPointOntoPlane(a.Cartesian3.add(e,u,T),T),e=o.projectPointOntoPlane(a.Cartesian3.add(e,n,B),B),n=a.Cartesian2.angleBetween(u,e),n=0<=e.x*u.y-e.y*u.x?-n:n;D=a.Matrix3.fromRotationZ(n,D),V.z=l,S=a.Matrix4.multiplyTransformation(S,a.Matrix4.fromRotationTranslation(D,V,A),S);var g=R;g[0]=C;for(var y=0;y<c;y++)for(var m=0;m<t.length;m+=3)d=a.Cartesian3.fromArray(t,m,d),d=a.Matrix3.multiplyByVector(g,d,d),d=a.Matrix4.multiplyByPoint(S,d,d),s.push(d.x,d.y,d.z);return s}var G=new a.Cartesian3;function H(e,r,n,t,i,s,o){for(var l=0;l<e.length;l+=3)t=N(a.Cartesian3.fromArray(e,l,G),r,n,t,i,s[l/3],o,1);return t}function L(e,a){for(var r=e.length,n=new Array(3*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=0;o<r;o++)n[t++]=e[o].x-i,n[t++]=0,n[t++]=e[o].y-s;return n}var j=new i.Quaternion,Q=new a.Cartesian3,q=new a.Matrix3;function F(e,r,t,s,o,C,c,u,d,g){var y,m=a.Cartesian3.angleBetween(a.Cartesian3.subtract(r,e,v),a.Cartesian3.subtract(t,e,E)),h=s===l.BEVELED?0:Math.ceil(m/n.CesiumMath.toRadians(5)),p=o?a.Matrix3.fromQuaternion(i.Quaternion.fromAxisAngle(a.Cartesian3.negate(e,v),m/(h+1),j),q):a.Matrix3.fromQuaternion(i.Quaternion.fromAxisAngle(e,m/(h+1),j),q);if(r=a.Cartesian3.clone(r,Q),0<h)for(var f=g?2:1,w=0;w<h;w++)r=a.Matrix3.multiplyByVector(p,r,r),y=a.Cartesian3.subtract(r,e,v),y=a.Cartesian3.normalize(y,y),o||(y=a.Cartesian3.negate(y,y)),c=N(C.scaleToGeodeticSurface(r,E),y,u,c,C,d,1,f);else y=a.Cartesian3.subtract(r,e,v),y=a.Cartesian3.normalize(y,y),o||(y=a.Cartesian3.negate(y,y)),c=N(C.scaleToGeodeticSurface(r,E),y,u,c,C,d,1,1),t=a.Cartesian3.clone(t,Q),y=a.Cartesian3.subtract(t,e,v),y=a.Cartesian3.normalize(y,y),o||(y=a.Cartesian3.negate(y,y)),c=N(C.scaleToGeodeticSurface(t,E),y,u,c,C,d,1,1);return c}P.removeDuplicatesFromShape=function(e){for(var r=e.length,n=[],t=r-1,i=0;i<r;t=i++){var s=e[t],o=e[i];a.Cartesian2.equals(s,o)||n.push(o)}return n},P.angleIsGreaterThanPi=function(e,n,t,i){return e=(i=new r.EllipsoidTangentPlane(t,i)).projectPointOntoPlane(a.Cartesian3.add(t,e,T),T),0<=(n=i.projectPointOntoPlane(a.Cartesian3.add(t,n,B),B)).x*e.y-n.y*e.x};var U=new a.Cartesian3,_=new a.Cartesian3;P.computePositions=function(e,r,i,s,o){var C=s._ellipsoid,E=function(e,a){for(var r=new Array(e.length),n=0;n<e.length;n++){var t=e[n];b=a.cartesianToCartographic(t,b),r[n]=b.height,e[n]=a.scaleToGeodeticSurface(t,t)}return r}(e,C),T=s._granularity,B=s._cornerType,z=(o?function(e,a){var r=e.length,n=new Array(6*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=e[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=e[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=e[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}:L)(r,i),S=(r=o?L(r,i):void 0,i.height/2),A=i.width/2,D=e.length,R=[],O=(i=o?[]:void 0,d),I=g,V=y,G=m,j=h,Q=p,q=f,Z=w,W=x,Y=e[0],k=e[1];G=C.geodeticSurfaceNormal(Y,G),O=a.Cartesian3.subtract(k,Y,O),O=a.Cartesian3.normalize(O,O),Z=a.Cartesian3.cross(G,O,Z);Z=a.Cartesian3.normalize(Z,Z);var J,K=E[0],X=E[1];o&&(i=N(Y,Z,r,i,C,K+S,1,1)),W=a.Cartesian3.clone(Y,W),Y=k,I=a.Cartesian3.negate(O,I);for(var $=1;$<D-1;$++){var ee,ae,re=o?2:1;k=e[$+1];Y.equals(k)?c("Positions are too close and are considered equivalent with rounding error."):(O=a.Cartesian3.subtract(k,Y,O),O=a.Cartesian3.normalize(O,O),V=a.Cartesian3.add(O,I,V),V=a.Cartesian3.normalize(V,V),G=C.geodeticSurfaceNormal(Y,G),ee=a.Cartesian3.multiplyByScalar(G,a.Cartesian3.dot(O,G),U),a.Cartesian3.subtract(O,ee,ee),a.Cartesian3.normalize(ee,ee),ae=a.Cartesian3.multiplyByScalar(G,a.Cartesian3.dot(I,G),_),a.Cartesian3.subtract(I,ae,ae),a.Cartesian3.normalize(ae,ae),n.CesiumMath.equalsEpsilon(Math.abs(a.Cartesian3.dot(ee,ae)),1,n.CesiumMath.EPSILON7)?(R=N(W,Z,z,R,C,K+S,1,1),W=Y):(V=a.Cartesian3.cross(V,G,V),V=a.Cartesian3.cross(G,V,V),V=a.Cartesian3.normalize(V,V),ee=1/Math.max(.25,a.Cartesian3.magnitude(a.Cartesian3.cross(V,I,v))),(ae=P.angleIsGreaterThanPi(O,I,Y,C))?(j=a.Cartesian3.add(Y,a.Cartesian3.multiplyByScalar(V,ee*A,V),j),Q=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,A,Q),Q),u[0]=a.Cartesian3.clone(W,u[0]),u[1]=a.Cartesian3.clone(Q,u[1]),J=M(u,K+S,X+S,T),R=H(t.PolylinePipeline.generateArc({positions:u,granularity:T,ellipsoid:C}),Z,z,R,C,J,1),Z=a.Cartesian3.cross(G,O,Z),Z=a.Cartesian3.normalize(Z,Z),q=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,A,q),q),B===l.ROUNDED||B===l.BEVELED?F(j,Q,q,B,ae,C,R,z,X+S,o):R=N(Y,V=a.Cartesian3.negate(V,V),z,R,C,X+S,ee,re)):(j=a.Cartesian3.add(Y,a.Cartesian3.multiplyByScalar(V,ee*A,V),j),Q=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,-A,Q),Q),u[0]=a.Cartesian3.clone(W,u[0]),u[1]=a.Cartesian3.clone(Q,u[1]),J=M(u,K+S,X+S,T),R=H(t.PolylinePipeline.generateArc({positions:u,granularity:T,ellipsoid:C}),Z,z,R,C,J,1),Z=a.Cartesian3.cross(G,O,Z),Z=a.Cartesian3.normalize(Z,Z),q=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,-A,q),q),B===l.ROUNDED||B===l.BEVELED?F(j,Q,q,B,ae,C,R,z,X+S,o):R=N(Y,V,z,R,C,X+S,ee,re)),W=a.Cartesian3.clone(q,W),I=a.Cartesian3.negate(O,I)),K=X,X=E[$+1],Y=k)}return u[0]=a.Cartesian3.clone(W,u[0]),u[1]=a.Cartesian3.clone(Y,u[1]),J=M(u,K+S,X+S,T),R=H(t.PolylinePipeline.generateArc({positions:u,granularity:T,ellipsoid:C}),Z,z,R,C,J,1),o&&(i=N(Y,Z,r,i,C,X+S,1,1)),D=R.length,r=o?D+i.length:D,(r=new Float64Array(r)).set(R),o&&r.set(i,D),r},e.CornerType=l,e.PolylineVolumeGeometryLibrary=P,e.oneTimeWarning=c}));