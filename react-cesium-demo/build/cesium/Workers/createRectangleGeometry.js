define(["./when-4bbc8319","./Matrix2-ccd5b911","./GeometryOffsetAttribute-1772960d","./Transforms-d5c6ad6e","./RuntimeError-346a3079","./ComponentDatatype-93750d1a","./GeometryAttribute-c30799b8","./GeometryAttributes-7827a6c2","./GeometryInstance-5f4fe82b","./GeometryPipeline-548e76d2","./IndexDatatype-b7d979a6","./PolygonPipeline-83fb62b0","./RectangleGeometryLibrary-48d34d36","./VertexFormat-71718faa","./combine-83860057","./WebGLConstants-1c8239cc","./AttributeCompression-1f045b73","./EncodedCartesian3-08b8d980","./IntersectionTests-4d6f5c54","./Plane-18bb00f8","./EllipsoidRhumbLine-aa9e6266"],(function(t,e,a,r,n,i,o,s,l,u,c,m,p,d,g,y,f,h,b,v,_){"use strict";var A=new e.Cartesian3,x=new e.Cartesian3,w=new e.Cartesian3,C=new e.Cartesian3,R=new e.Rectangle,E=new e.Cartesian2,F=new r.BoundingSphere,G=new r.BoundingSphere;function P(t,e){var a=new o.Geometry({attributes:new s.GeometryAttributes,primitiveType:o.PrimitiveType.TRIANGLES});return a.attributes.position=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var V=new e.Cartesian3,L=new e.Cartesian3;function D(t,a){var r=t._vertexFormat,n=t._ellipsoid,s=a.height,l=a.width,u=a.northCap,m=a.southCap,d=0,g=s,y=s;t=0;u&&(--y,t+=d=1),m&&(--g,--y,t+=1),t+=l*y;for(var f=r.position?new Float64Array(3*t):void 0,h=r.st?new Float32Array(2*t):void 0,b=0,v=0,_=A,R=E,F=Number.MAX_VALUE,G=Number.MAX_VALUE,V=-Number.MAX_VALUE,L=-Number.MAX_VALUE,D=d;D<g;++D)for(var M=0;M<l;++M)p.RectangleGeometryLibrary.computePosition(a,n,r.st,D,M,_,R),f[b++]=_.x,f[b++]=_.y,f[b++]=_.z,r.st&&(h[v++]=R.x,h[v++]=R.y,F=Math.min(F,R.x),G=Math.min(G,R.y),V=Math.max(V,R.x),L=Math.max(L,R.y));if(u&&(p.RectangleGeometryLibrary.computePosition(a,n,r.st,0,0,_,R),f[b++]=_.x,f[b++]=_.y,f[b++]=_.z,r.st&&(h[v++]=R.x,h[v++]=R.y,F=R.x,G=R.y,V=R.x,L=R.y)),m&&(p.RectangleGeometryLibrary.computePosition(a,n,r.st,s-1,0,_,R),f[b++]=_.x,f[b++]=_.y,f[b]=_.z,r.st&&(h[v++]=R.x,h[v]=R.y,F=Math.min(F,R.x),G=Math.min(G,R.y),V=Math.max(V,R.x),L=Math.max(L,R.y))),r.st&&(F<0||G<0||1<V||1<L))for(var T=0;T<h.length;T+=2)h[T]=(h[T]-F)/(V-F),h[T+1]=(h[T+1]-G)/(L-G);d=function(t,a,r,n){var i=t.length,o=a.normal?new Float32Array(i):void 0,s=a.tangent?new Float32Array(i):void 0,l=a.bitangent?new Float32Array(i):void 0,u=0,c=C,m=w,p=x;if(a.normal||a.tangent||a.bitangent)for(var d=0;d<i;d+=3){var g=e.Cartesian3.fromArray(t,d,A),y=u+1,f=u+2;p=r.geodeticSurfaceNormal(g,p);(a.tangent||a.bitangent)&&(e.Cartesian3.cross(e.Cartesian3.UNIT_Z,p,m),e.Matrix3.multiplyByVector(n,m,m),e.Cartesian3.normalize(m,m),a.bitangent&&e.Cartesian3.normalize(e.Cartesian3.cross(p,m,c),c)),a.normal&&(o[u]=p.x,o[y]=p.y,o[f]=p.z),a.tangent&&(s[u]=m.x,s[y]=m.y,s[f]=m.z),a.bitangent&&(l[u]=c.x,l[y]=c.y,l[f]=c.z),u+=3}return P(a,{positions:t,normals:o,tangents:s,bitangents:l})}(f,r,n,a.tangentRotationMatrix),s=6*(l-1)*(y-1),u&&(s+=3*(l-1)),m&&(s+=3*(l-1));for(var O=c.IndexDatatype.createTypedArray(t,s),N=0,S=0,I=0;I<y-1;++I){for(var k=0;k<l-1;++k){var H=N,z=H+l,B=z+1,U=H+1;O[S++]=H,O[S++]=z,O[S++]=U,O[S++]=U,O[S++]=z,O[S++]=B,++N}++N}if(u||m){var Y,q,X=t-1,Q=t-1;if(u&&m&&(X=t-2),N=0,u)for(I=0;I<l-1;I++)q=(Y=N)+1,O[S++]=X,O[S++]=Y,O[S++]=q,++N;if(m)for(N=(y-1)*l,I=0;I<l-1;I++)q=(Y=N)+1,O[S++]=Y,O[S++]=Q,O[S++]=q,++N}return d.indices=O,r.st&&(d.attributes.st=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),d}function M(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function T(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var O=new d.VertexFormat;var N=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],S=new e.Cartographic,I=new e.Cartographic;function k(t,a,r,n,i){if(0===r)return e.Rectangle.clone(t,i);var o=p.RectangleGeometryLibrary.computeOptions(t,a,r,0,R,S);t=o.height,a=o.width,r=N;return p.RectangleGeometryLibrary.computePosition(o,n,!1,0,0,r[0]),p.RectangleGeometryLibrary.computePosition(o,n,!1,0,a-1,r[1]),p.RectangleGeometryLibrary.computePosition(o,n,!1,t-1,0,r[2]),p.RectangleGeometryLibrary.computePosition(o,n,!1,t-1,a-1,r[3]),e.Rectangle.fromCartesianArray(r,n,i)}function H(a){var r=(a=t.defaultValue(a,t.defaultValue.EMPTY_OBJECT)).rectangle,n=t.defaultValue(a.height,0),o=t.defaultValue(a.extrudedHeight,n);this._rectangle=e.Rectangle.clone(r),this._granularity=t.defaultValue(a.granularity,i.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.Ellipsoid.clone(t.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(n,o),this._rotation=t.defaultValue(a.rotation,0),this._stRotation=t.defaultValue(a.stRotation,0),this._vertexFormat=d.VertexFormat.clone(t.defaultValue(a.vertexFormat,d.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(n,o),this._shadowVolume=t.defaultValue(a.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=a.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}H.packedLength=e.Rectangle.packedLength+e.Ellipsoid.packedLength+d.VertexFormat.packedLength+7,H.pack=function(a,r,n){return n=t.defaultValue(n,0),e.Rectangle.pack(a._rectangle,r,n),n+=e.Rectangle.packedLength,e.Ellipsoid.pack(a._ellipsoid,r,n),n+=e.Ellipsoid.packedLength,d.VertexFormat.pack(a._vertexFormat,r,n),n+=d.VertexFormat.packedLength,r[n++]=a._granularity,r[n++]=a._surfaceHeight,r[n++]=a._rotation,r[n++]=a._stRotation,r[n++]=a._extrudedHeight,r[n++]=a._shadowVolume?1:0,r[n]=t.defaultValue(a._offsetAttribute,-1),r};var z=new e.Rectangle,B=e.Ellipsoid.clone(e.Ellipsoid.UNIT_SPHERE),U={rectangle:z,ellipsoid:B,vertexFormat:O,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};H.unpack=function(a,r,n){r=t.defaultValue(r,0);var i=e.Rectangle.unpack(a,r,z);r+=e.Rectangle.packedLength;var o=e.Ellipsoid.unpack(a,r,B);r+=e.Ellipsoid.packedLength;var s=d.VertexFormat.unpack(a,r,O);r+=d.VertexFormat.packedLength;var l=a[r++],u=a[r++],c=a[r++],m=a[r++],p=a[r++],g=1===a[r++];r=a[r];return t.defined(n)?(n._rectangle=e.Rectangle.clone(i,n._rectangle),n._ellipsoid=e.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=d.VertexFormat.clone(s,n._vertexFormat),n._granularity=l,n._surfaceHeight=u,n._rotation=c,n._stRotation=m,n._extrudedHeight=p,n._shadowVolume=g,n._offsetAttribute=-1===r?void 0:r,n):(U.granularity=l,U.height=u,U.rotation=c,U.stRotation=m,U.extrudedHeight=p,U.shadowVolume=g,U.offsetAttribute=-1===r?void 0:r,new H(U))},H.computeRectangle=function(a,r){var n=(a=t.defaultValue(a,t.defaultValue.EMPTY_OBJECT)).rectangle,o=t.defaultValue(a.granularity,i.CesiumMath.RADIANS_PER_DEGREE),s=t.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84);return k(n,o,t.defaultValue(a.rotation,0),s,r)};var Y=new e.Matrix3,q=new r.Quaternion,X=new e.Cartographic;H.createGeometry=function(n){if(!i.CesiumMath.equalsEpsilon(n._rectangle.north,n._rectangle.south,i.CesiumMath.EPSILON10)&&!i.CesiumMath.equalsEpsilon(n._rectangle.east,n._rectangle.west,i.CesiumMath.EPSILON10)){var s=n._rectangle,g=n._ellipsoid,y=n._rotation,f=n._stRotation,h=n._vertexFormat,b=p.RectangleGeometryLibrary.computeOptions(s,n._granularity,y,f,R,S,I),v=Y;0!==f||0!==y?(N=e.Rectangle.center(s,X),k=g.geodeticSurfaceNormalCartographic(N,V),r.Quaternion.fromAxisAngle(k,-f,q),e.Matrix3.fromQuaternion(q,v)):e.Matrix3.clone(e.Matrix3.IDENTITY,v);var _,E,N=n._surfaceHeight,k=n._extrudedHeight;f=!i.CesiumMath.equalsEpsilon(N,k,0,i.CesiumMath.EPSILON2);return b.lonScalar=1/n._rectangle.width,b.latScalar=1/n._rectangle.height,b.tangentRotationMatrix=v,s=n._rectangle,N=f?(_=function(r,n){var s=r._shadowVolume,p=r._offsetAttribute,g=r._vertexFormat,y=r._extrudedHeight,f=r._surfaceHeight,h=r._ellipsoid,b=n.height,v=n.width;s&&((k=d.VertexFormat.clone(g,O)).normal=!0,r._vertexFormat=k);var _=D(r,n);s&&(r._vertexFormat=g);var R=m.PolygonPipeline.scaleToGeodeticHeight(_.attributes.position.values,f,h,!1),E=2*(lt=(R=new Float64Array(R)).length),F=new Float64Array(E);F.set(R);var G=m.PolygonPipeline.scaleToGeodeticHeight(_.attributes.position.values,y,h);F.set(G,lt),_.attributes.position.values=F;var N,S,I,k=g.normal?new Float32Array(E):void 0;if(r=g.tangent?new Float32Array(E):void 0,f=g.bitangent?new Float32Array(E):void 0,y=g.st?new Float32Array(E/3*2):void 0,g.normal){for(S=_.attributes.normal.values,k.set(S),z=0;z<lt;z++)S[z]=-S[z];k.set(S,lt),_.attributes.normal.values=k}if(s){S=_.attributes.normal.values,g.normal||(_.attributes.normal=void 0);for(var H=new Float32Array(E),z=0;z<lt;z++)S[z]=-S[z];H.set(S,lt),_.attributes.extrudeDirection=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H})}if((F=t.defined(p))&&(k=lt/3*2,H=new Uint8Array(k),H=p===a.GeometryOffsetAttribute.TOP?a.arrayFill(H,1,0,k/2):(I=p===a.GeometryOffsetAttribute.NONE?0:1,a.arrayFill(H,I)),_.attributes.applyOffset=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:H})),g.tangent){var B=_.attributes.tangent.values;for(r.set(B),z=0;z<lt;z++)B[z]=-B[z];r.set(B,lt),_.attributes.tangent.values=r}g.bitangent&&(Q=_.attributes.bitangent.values,f.set(Q),f.set(Q,lt),_.attributes.bitangent.values=f),g.st&&(N=_.attributes.st.values,y.set(N),y.set(N,lt/3*2),_.attributes.st.values=y);var U=_.indices,Y=U.length,q=lt/3,X=c.IndexDatatype.createTypedArray(E/3,2*Y);for(X.set(U),z=0;z<Y;z+=3)X[z+Y]=U[z+2]+q,X[z+1+Y]=U[z+1]+q,X[z+2+Y]=U[z]+q;_.indices=X,r=n.northCap;var Q=n.southCap;f=b,y=2,E=0,n=4,b=4,r&&(--y,--f,E+=1,n-=2,--b),Q&&(--y,--f,E+=1,n-=2,--b),b=2*((E+=y*v+2*f-n)+b);var W=new Float64Array(3*b),J=s?new Float32Array(3*b):void 0,j=F?new Uint8Array(b):void 0,Z=g.st?new Float32Array(2*b):void 0,K=p===a.GeometryOffsetAttribute.TOP;F&&!K&&(I=p===a.GeometryOffsetAttribute.ALL?1:0,j=a.arrayFill(j,I));var $=0,tt=0,et=0,at=0,rt=v*f;for(z=0;z<rt;z+=v)W=M(W,$,it=3*z,R,G),$+=6,g.st&&(Z=T(Z,tt,2*z,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1);if(Q){var nt=r?1+rt:rt,it=3*nt;for(z=0;z<2;z++)W=M(W,$,it,R,G),$+=6,g.st&&(Z=T(Z,tt,2*nt,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1)}else for(z=rt-v;z<rt;z++)W=M(W,$,it=3*z,R,G),$+=6,g.st&&(Z=T(Z,tt,2*z,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1);for(z=rt-1;0<z;z-=v)W=M(W,$,it=3*z,R,G),$+=6,g.st&&(Z=T(Z,tt,2*z,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1);if(r){var ot=rt;for(it=3*ot,z=0;z<2;z++)W=M(W,$,it,R,G),$+=6,g.st&&(Z=T(Z,tt,2*ot,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1)}else for(z=v-1;0<=z;z--)W=M(W,$,it=3*z,R,G),$+=6,g.st&&(Z=T(Z,tt,2*z,N),tt+=4),s&&(et+=3,J[et++]=S[it],J[et++]=S[it+1],J[et++]=S[it+2]),K&&(j[at++]=1,at+=1);h=function(t,a,r){var n=t.length,o=a.normal?new Float32Array(n):void 0,s=a.tangent?new Float32Array(n):void 0,l=a.bitangent?new Float32Array(n):void 0,u=0,c=0,m=0,p=!0,d=C,g=w,y=x;if(a.normal||a.tangent||a.bitangent)for(var f=0;f<n;f+=6){var h,b=e.Cartesian3.fromArray(t,f,A),v=e.Cartesian3.fromArray(t,(f+6)%n,V);p&&(h=e.Cartesian3.fromArray(t,(f+3)%n,L),e.Cartesian3.subtract(v,b,v),e.Cartesian3.subtract(h,b,h),y=e.Cartesian3.normalize(e.Cartesian3.cross(h,v,y),y),p=!1),e.Cartesian3.equalsEpsilon(v,b,i.CesiumMath.EPSILON10)&&(p=!0),(a.tangent||a.bitangent)&&(d=r.geodeticSurfaceNormal(b,d),a.tangent&&(g=e.Cartesian3.normalize(e.Cartesian3.cross(d,y,g),g))),a.normal&&(o[u++]=y.x,o[u++]=y.y,o[u++]=y.z,o[u++]=y.x,o[u++]=y.y,o[u++]=y.z),a.tangent&&(s[c++]=g.x,s[c++]=g.y,s[c++]=g.z,s[c++]=g.x,s[c++]=g.y,s[c++]=g.z),a.bitangent&&(l[m++]=d.x,l[m++]=d.y,l[m++]=d.z,l[m++]=d.x,l[m++]=d.y,l[m++]=d.z)}return P(a,{positions:t,normals:o,tangents:s,bitangents:l})}(W,g,h),g.st&&(h.attributes.st=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:Z})),s&&(h.attributes.extrudeDirection=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:J})),F&&(h.attributes.applyOffset=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:j}));var st=c.IndexDatatype.createTypedArray(b,6*E),lt=W.length/3,ut=0;for(z=0;z<lt-1;z+=2){var ct,mt=((ct=z)+2)%lt,pt=e.Cartesian3.fromArray(W,3*ct,V),dt=e.Cartesian3.fromArray(W,3*mt,L);e.Cartesian3.equalsEpsilon(pt,dt,i.CesiumMath.EPSILON10)||(dt=(2+(pt=(ct+1)%lt))%lt,st[ut++]=ct,st[ut++]=pt,st[ut++]=mt,st[ut++]=mt,st[ut++]=pt,st[ut++]=dt)}return h.indices=st,(h=u.GeometryPipeline.combineInstances([new l.GeometryInstance({geometry:_}),new l.GeometryInstance({geometry:h})]))[0]}(n,b),f=r.BoundingSphere.fromRectangle3D(s,g,N,G),E=r.BoundingSphere.fromRectangle3D(s,g,k,F),r.BoundingSphere.union(f,E)):((_=D(n,b)).attributes.position.values=m.PolygonPipeline.scaleToGeodeticHeight(_.attributes.position.values,N,g,!1),t.defined(n._offsetAttribute)&&(E=_.attributes.position.values.length,b=new Uint8Array(E/3),E=n._offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1,a.arrayFill(b,E),_.attributes.applyOffset=new o.GeometryAttribute({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})),r.BoundingSphere.fromRectangle3D(s,g,N)),h.position||delete _.attributes.position,new o.Geometry({attributes:_.attributes,indices:_.indices,primitiveType:_.primitiveType,boundingSphere:N,offsetAttribute:n._offsetAttribute})}},H.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid;e=e(r,n),a=a(r,n);return new H({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:a,height:e,vertexFormat:d.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var Q=new e.Rectangle,W=[new e.Cartesian2,new e.Cartesian2,new e.Cartesian2],J=new e.Matrix2,j=new e.Cartographic;return Object.defineProperties(H.prototype,{rectangle:{get:function(){return t.defined(this._rotatedRectangle)||(this._rotatedRectangle=k(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var a=e.Rectangle.clone(t._rectangle,Q),r=t._granularity,n=t._ellipsoid,i=(a=k(a,r,t._rotation-t._stRotation,n,Q),W);i[0].x=a.west,i[0].y=a.south,i[1].x=a.west,i[1].y=a.north,i[2].x=a.east,i[2].y=a.south;for(var o=t.rectangle,s=e.Matrix2.fromRotation(t._stRotation,J),l=e.Rectangle.center(o,j),u=0;u<3;++u){var c=i[u];c.x-=l.longitude,c.y-=l.latitude,e.Matrix2.multiplyByVector(s,c,c),c.x+=l.longitude,c.y+=l.latitude,c.x=(c.x-o.west)/o.width,c.y=(c.y-o.south)/o.height}return r=i[0],n=i[1],a=i[2],t=new Array(6),e.Cartesian2.pack(r,t),e.Cartesian2.pack(n,t,2),e.Cartesian2.pack(a,t,4),t}(this)),this._textureCoordinateRotationPoints}}}),function(a,r){return(a=t.defined(r)?H.unpack(a,r):a)._ellipsoid=e.Ellipsoid.clone(a._ellipsoid),a._rectangle=e.Rectangle.clone(a._rectangle),H.createGeometry(a)}}));