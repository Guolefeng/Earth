define(["./arrayRemoveDuplicates-18786327","./BoundingRectangle-2b0e1a9b","./Transforms-d5c6ad6e","./Matrix2-ccd5b911","./RuntimeError-346a3079","./ComponentDatatype-93750d1a","./CoplanarPolygonGeometryLibrary-54c559e2","./when-4bbc8319","./GeometryAttribute-c30799b8","./GeometryAttributes-7827a6c2","./GeometryInstance-5f4fe82b","./GeometryPipeline-548e76d2","./IndexDatatype-b7d979a6","./PolygonGeometryLibrary-d35c292d","./PolygonPipeline-83fb62b0","./VertexFormat-71718faa","./combine-83860057","./WebGLConstants-1c8239cc","./OrientedBoundingBox-0a826a8b","./EllipsoidTangentPlane-e000bae1","./AxisAlignedBoundingBox-883f9c89","./IntersectionTests-4d6f5c54","./Plane-18bb00f8","./AttributeCompression-1f045b73","./EncodedCartesian3-08b8d980","./ArcType-98ec98bf","./EllipsoidRhumbLine-aa9e6266"],(function(e,t,n,a,r,o,i,l,s,p,y,c,m,u,d,g,b,h,v,x,C,f,P,A,w,F,G){"use strict";var L=new a.Cartesian3,E=new t.BoundingRectangle,T=new a.Cartesian2,D=new a.Cartesian2,_=new a.Cartesian3,V=new a.Cartesian3,k=new a.Cartesian3,R=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,B=new n.Quaternion,H=new a.Matrix3,O=new a.Matrix3,z=new a.Cartesian3;function S(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=l.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT);this._vertexFormat=g.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(l.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=u.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+g.VertexFormat.packedLength+a.Ellipsoid.packedLength+2}S.fromPositions=function(e){return new S({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},S.pack=function(e,t,n){return n=l.defaultValue(n,0),n=u.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,n),n+=g.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var N=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),Q=new g.VertexFormat,j={polygonHierarchy:{}};return S.unpack=function(e,t,n){t=l.defaultValue(t,0);var r=u.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=a.Ellipsoid.unpack(e,t,N);t+=a.Ellipsoid.packedLength;var i=g.VertexFormat.unpack(e,t,Q);t+=g.VertexFormat.packedLength;var s=e[t++];t=e[t];return(n=l.defined(n)?n:new S(j))._polygonHierarchy=r,n._ellipsoid=a.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=g.VertexFormat.clone(i,n._vertexFormat),n._stRotation=s,n.packedLength=t,n},S.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,g=t._stRotation,b=l.positions;if(!((b=e.arrayRemoveDuplicates(b,a.Cartesian3.equalsEpsilon,!0)).length<3)){var h=_,v=V,x=k,C=I,f=M;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(b,R,C,f)){h=a.Cartesian3.cross(C,f,h),h=a.Cartesian3.normalize(h,h),a.Cartesian3.equalsEpsilon(R,a.Cartesian3.ZERO,o.CesiumMath.EPSILON6)||(P=t._ellipsoid.geodeticSurfaceNormal(R,z),a.Cartesian3.dot(h,P)<0&&(h=a.Cartesian3.negate(h,h),C=a.Cartesian3.negate(C,C)));var P=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,C,f),A=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,C,f);r.tangent&&(v=a.Cartesian3.clone(C,v)),r.bitangent&&(x=a.Cartesian3.clone(f,x));P=(l=u.PolygonGeometryLibrary.polygonsFromHierarchy(l,P,!1)).hierarchy;var w=l.polygons;if(0!==P.length){b=P[0].outerRing,l=n.BoundingSphere.fromPoints(b);for(var F=u.PolygonGeometryLibrary.computeBoundingRectangle(h,A,b,g,E),G=[],S=0;S<w.length;S++){var N=new y.GeometryInstance({geometry:function(e,t,r,i,l,y,c,u){var g=e.positions,b=d.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]),(e=m.IndexDatatype.createTypedArray(g.length,b.length)).set(b);var h=H;0!==i?(b=n.Quaternion.fromAxisAngle(y,i,B),h=a.Matrix3.fromQuaternion(b,h),(t.tangent||t.bitangent)&&(b=n.Quaternion.fromAxisAngle(y,-i,B),C=a.Matrix3.fromQuaternion(b,O),c=a.Cartesian3.normalize(a.Matrix3.multiplyByVector(C,c,c),c),t.bitangent&&(u=a.Cartesian3.normalize(a.Cartesian3.cross(y,c,u),u)))):h=a.Matrix3.clone(a.Matrix3.IDENTITY,h);var v=D;t.st&&(v.x=r.x,v.y=r.y);for(var x=g.length,C=3*x,f=new Float64Array(C),P=t.normal?new Float32Array(C):void 0,A=t.tangent?new Float32Array(C):void 0,w=t.bitangent?new Float32Array(C):void 0,F=t.st?new Float32Array(2*x):void 0,G=0,E=0,_=0,V=0,k=0,R=0;R<x;R++){var I,M=g[R];f[G++]=M.x,f[G++]=M.y,f[G++]=M.z,t.st&&(I=l(a.Matrix3.multiplyByVector(h,M,L),T),a.Cartesian2.subtract(I,v,I),M=o.CesiumMath.clamp(I.x/r.width,0,1),I=o.CesiumMath.clamp(I.y/r.height,0,1),F[k++]=M,F[k++]=I),t.normal&&(P[E++]=y.x,P[E++]=y.y,P[E++]=y.z),t.tangent&&(A[V++]=c.x,A[V++]=c.y,A[V++]=c.z),t.bitangent&&(w[_++]=u.x,w[_++]=u.y,w[_++]=u.z)}return C=new p.GeometryAttributes,t.position&&(C.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})),t.normal&&(C.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P})),t.tangent&&(C.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.bitangent&&(C.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.st&&(C.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:F})),new s.Geometry({attributes:C,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(w[S],r,F,g,A,h,v,x)});G.push(N)}return(P=c.GeometryPipeline.combineInstances(G)[0]).attributes.position.values=new Float64Array(P.attributes.position.values),P.indices=m.IndexDatatype.createTypedArray(P.attributes.position.values.length/3,P.indices),b=P.attributes,r.position||delete b.position,new s.Geometry({attributes:b,indices:P.indices,primitiveType:P.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=S.unpack(e,t)),S.createGeometry(e)}}));