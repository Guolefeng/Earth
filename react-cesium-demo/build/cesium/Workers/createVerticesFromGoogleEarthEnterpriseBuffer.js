define(["./AxisAlignedBoundingBox-883f9c89","./Transforms-d5c6ad6e","./Matrix2-ccd5b911","./when-4bbc8319","./TerrainEncoding-bccee540","./ComponentDatatype-93750d1a","./OrientedBoundingBox-0a826a8b","./RuntimeError-346a3079","./WebMercatorProjection-b29097b4","./createTaskProcessorWorker","./combine-83860057","./AttributeCompression-1f045b73","./WebGLConstants-1c8239cc","./EllipsoidTangentPlane-e000bae1","./IntersectionTests-4d6f5c54","./Plane-18bb00f8"],(function(e,t,i,n,r,a,o,s,u,h,c,d,g,l,m,p){"use strict";var I=Uint16Array.BYTES_PER_ELEMENT,E=Int32Array.BYTES_PER_ELEMENT,T=Uint32Array.BYTES_PER_ELEMENT,f=Float32Array.BYTES_PER_ELEMENT,C=Float64Array.BYTES_PER_ELEMENT;function v(e,t,i){i=n.defaultValue(i,a.CesiumMath);for(var r=e.length,o=0;o<r;++o)if(i.equalsEpsilon(e[o],t,a.CesiumMath.EPSILON12))return o;return-1}var M=new i.Cartographic,x=new i.Cartesian3,N=new i.Cartesian3,b=new i.Cartesian3,S=new i.Matrix4;function w(e,t,r,o,s,u,h,c,d,g,l){for(var m=c.length,p=0;p<m;++p){var I=c[p],E=I.cartographic,T=I.index,f=e.length,C=E.longitude,v=E.latitude;v=a.CesiumMath.clamp(v,-a.CesiumMath.PI_OVER_TWO,a.CesiumMath.PI_OVER_TWO),E=E.height-h.skirtHeight;h.hMin=Math.min(h.hMin,E),i.Cartographic.fromRadians(C,v,E,M),g&&(M.longitude+=d),g?p===m-1?M.latitude+=l:0===p&&(M.latitude-=l):M.latitude+=d,v=h.ellipsoid.cartographicToCartesian(M),e.push(v),t.push(E),r.push(i.Cartesian2.clone(r[T])),0<o.length&&o.push(o[T]),0<s.length&&s.push(s[T]),i.Matrix4.multiplyByPoint(h.toENU,v,x),E=h.minimum,v=h.maximum,i.Cartesian3.minimumByComponent(x,E,E),i.Cartesian3.maximumByComponent(x,v,v),v=h.lastBorderPoint,n.defined(v)&&(v=v.index,u.push(v,f-1,f,f,T,v)),h.lastBorderPoint=I}}return h((function(h,c){h.ellipsoid=i.Ellipsoid.clone(h.ellipsoid),h.rectangle=i.Rectangle.clone(h.rectangle);var d=function(h,c,d,g,l,m,p,B,P,A,y){var R,_,W,F,O;_e=n.defined(g)?(R=g.west,_=g.south,W=g.east,F=g.north,O=g.width,g.height):(R=a.CesiumMath.toRadians(l.west),_=a.CesiumMath.toRadians(l.south),W=a.CesiumMath.toRadians(l.east),F=a.CesiumMath.toRadians(l.north),O=a.CesiumMath.toRadians(g.width),a.CesiumMath.toRadians(g.height));var Y,U,V=[_,F],k=[R,W],H=t.Transforms.eastNorthUpToFixedFrame(c,d),L=i.Matrix4.inverseTransformation(H,S);P&&(Y=u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_),U=1/(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(F)-Y));var D=1!==m,G=new DataView(h),j=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,q=N;q.x=Number.POSITIVE_INFINITY,q.y=Number.POSITIVE_INFINITY,q.z=Number.POSITIVE_INFINITY;var J=b;J.x=Number.NEGATIVE_INFINITY,J.y=Number.NEGATIVE_INFINITY,J.z=Number.NEGATIVE_INFINITY;var K,Q,X=0,Z=0,$=0;for(Q=0;Q<4;++Q){var ee=X;K=G.getUint32(ee,!0),ee+=T;var te=a.CesiumMath.toRadians(180*G.getFloat64(ee,!0));ee+=C,-1===v(k,te)&&k.push(te),te=a.CesiumMath.toRadians(180*G.getFloat64(ee,!0)),ee+=C,-1===v(V,te)&&V.push(te),ee+=2*C,te=G.getInt32(ee,!0),ee+=E,Z+=te,$+=3*(te=G.getInt32(ee,!0)),X+=K+T}var ie=[],ne=[],re=new Array(Z),ae=new Array(Z),oe=new Array(Z),se=P?new Array(Z):[],ue=D?new Array(Z):[],he=new Array($),ce=[],de=[],ge=[],le=[],me=0,pe=0;for(Q=X=0;Q<4;++Q){K=G.getUint32(X,!0);var Ie=X+=T,Ee=a.CesiumMath.toRadians(180*G.getFloat64(X,!0));X+=C;var Te=a.CesiumMath.toRadians(180*G.getFloat64(X,!0));X+=C;var fe=a.CesiumMath.toRadians(180*G.getFloat64(X,!0)),Ce=.5*fe;X+=C;var ve=a.CesiumMath.toRadians(180*G.getFloat64(X,!0)),Me=.5*ve;X+=C;var xe=G.getInt32(X,!0);X+=E;var Ne=G.getInt32(X,!0);X+=E,X+=E;for(var be=new Array(xe),Se=0;Se<xe;++Se){var we=Ee+G.getUint8(X++)*fe;M.longitude=we;var Be=Te+G.getUint8(X++)*ve;M.latitude=Be;var Pe=G.getFloat32(X,!0);if(X+=f,0!==Pe&&Pe<y&&(Pe*=-Math.pow(2,A)),Pe*=6371010,M.height=Pe,-1!==v(k,we)||-1!==v(V,Be)){var Ae=v(ie,M,i.Cartographic);if(-1!==Ae){be[Se]=ne[Ae];continue}ie.push(i.Cartographic.clone(M)),ne.push(me)}be[Se]=me,Math.abs(we-R)<Ce?ce.push({index:me,cartographic:i.Cartographic.clone(M)}):Math.abs(we-W)<Ce?ge.push({index:me,cartographic:i.Cartographic.clone(M)}):Math.abs(Be-_)<Me?de.push({index:me,cartographic:i.Cartographic.clone(M)}):Math.abs(Be-F)<Me&&le.push({index:me,cartographic:i.Cartographic.clone(M)}),j=Math.min(Pe,j),z=Math.max(Pe,z),oe[me]=Pe,Ae=d.cartographicToCartesian(M),re[me]=Ae,P&&(se[me]=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Be)-Y)*U),D&&(Pe=d.geodeticSurfaceNormal(Ae),ue[me]=Pe),i.Matrix4.multiplyByPoint(L,Ae,x),i.Cartesian3.minimumByComponent(x,q,q),i.Cartesian3.maximumByComponent(x,J,J),we=(we-R)/(W-R),we=a.CesiumMath.clamp(we,0,1),Be=(Be-_)/(F-_),Be=a.CesiumMath.clamp(Be,0,1),ae[me]=new i.Cartesian2(we,Be),++me}for(var ye=3*Ne,Re=0;Re<ye;++Re,++pe)he[pe]=be[G.getUint16(X,!0)],X+=I;if(K!==X-Ie)throw new s.RuntimeError("Invalid terrain tile.")}re.length=me,ae.length=me,oe.length=me,P&&(se.length=me),D&&(ue.length=me);var _e,We=me;l=pe,h={hMin:j,lastBorderPoint:void 0,skirtHeight:B,toENU:L,ellipsoid:d,minimum:q,maximum:J};ce.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),de.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),ge.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),le.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude})),w(re,oe,ae,se,ue,he,h,ce,-(B=1e-5)*O,!0,-B*_e),w(re,oe,ae,se,ue,he,h,de,-B*_e,!1),w(re,oe,ae,se,ue,he,h,ge,B*O,!0,B*_e),w(re,oe,ae,se,ue,he,h,le,B*_e,!1),0<ce.length&&0<le.length&&(Oe=ce[0].index,Ye=le[le.length-1].index,_e=re.length-1,he.push(Ye,_e,We,We,Oe,Ye)),Z=re.length;var Fe,Oe=t.BoundingSphere.fromPoints(re);n.defined(g)&&(Fe=o.OrientedBoundingBox.fromRectangle(g,j,z,d));for(var Ye=new r.EllipsoidalOccluder(d).computeHorizonCullingPointPossiblyUnderEllipsoid(c,re,j),Ue=(g=new e.AxisAlignedBoundingBox(q,J,c),new r.TerrainEncoding(c,g,h.hMin,z,H,!1,P,D,m,p)),Ve=new Float32Array(Z*Ue.stride),ke=0,He=0;He<Z;++He)ke=Ue.encode(Ve,ke,re[He],ae[He],oe[He],void 0,se[He],ue[He]);return h=ce.map((function(e){return e.index})).reverse(),H=de.map((function(e){return e.index})).reverse(),m=ge.map((function(e){return e.index})).reverse(),p=le.map((function(e){return e.index})).reverse(),H.unshift(m[m.length-1]),H.push(h[0]),p.unshift(h[h.length-1]),p.push(m[0]),{vertices:Ve,indices:new Uint16Array(he),maximumHeight:z,minimumHeight:j,encoding:Ue,boundingSphere3D:Oe,orientedBoundingBox:Fe,occludeePointInScaledSpace:Ye,vertexCountWithoutSkirts:We,indexCountWithoutSkirts:l,westIndicesSouthToNorth:h,southIndicesEastToWest:H,eastIndicesNorthToSouth:m,northIndicesWestToEast:p}}(h.buffer,h.relativeToCenter,h.ellipsoid,h.rectangle,h.nativeRectangle,h.exaggeration,h.exaggerationRelativeHeight,h.skirtHeight,h.includeWebMercatorT,h.negativeAltitudeExponentBias,h.negativeElevationThreshold),g=d.vertices;return c.push(g.buffer),h=d.indices,c.push(h.buffer),{vertices:g.buffer,indices:h.buffer,numberOfAttributes:d.encoding.stride,minimumHeight:d.minimumHeight,maximumHeight:d.maximumHeight,boundingSphere3D:d.boundingSphere3D,orientedBoundingBox:d.orientedBoundingBox,occludeePointInScaledSpace:d.occludeePointInScaledSpace,encoding:d.encoding,vertexCountWithoutSkirts:d.vertexCountWithoutSkirts,indexCountWithoutSkirts:d.indexCountWithoutSkirts,westIndicesSouthToNorth:d.westIndicesSouthToNorth,southIndicesEastToWest:d.southIndicesEastToWest,eastIndicesNorthToSouth:d.eastIndicesNorthToSouth,northIndicesWestToEast:d.northIndicesWestToEast}}))}));